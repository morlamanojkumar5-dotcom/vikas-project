 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPortal - Student Teacher Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff6b6b;
            --secondary: #4ecdc4;
            --success: #1dd1a1;
            --warning: #feca57;
            --danger: #ff9ff3;
            --info: #54a0ff;
            --light: #f7f7f7;
            --dark: #222f3e;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --gradient-reverse: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            --card-shadow: 0 10px 30px rgba(255, 107, 107, 0.15);
            --hover-shadow: 0 15px 40px rgba(255, 107, 107, 0.25);
            --glow: 0 0 15px rgba(255, 107, 107, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            padding: 30px;
            margin-bottom: 25px;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.7s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: var(--hover-shadow), var(--glow);
        }

        .hidden {
            display: none !important;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary { background: var(--gradient); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-light { background: var(--light); color: var(--dark); }
        .btn-info { background: var(--info); color: white; }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            filter: brightness(1.1);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--light);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
            background: white;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            position: relative;
        }

        .header h1 {
            color: white;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
        }

        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.3em;
            font-weight: 300;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            position: relative;
        }

        .tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            background: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            border-right: 1px solid #e9ecef;
            position: relative;
            overflow: hidden;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: var(--gradient);
            color: white;
        }

        .tab:hover:not(.active) {
            background: #e9ecef;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 25px;
            min-height: 80vh;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            height: fit-content;
            position: sticky;
            top: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar-menu {
            list-style: none;
            margin-top: 20px;
        }

        .sidebar-menu li {
            padding: 15px 20px;
            margin-bottom: 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .sidebar-menu li::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .sidebar-menu li:hover::before, .sidebar-menu li.active::before {
            left: 100%;
        }

        .sidebar-menu li:hover, .sidebar-menu li.active {
            background: var(--gradient);
            color: white;
            transform: translateX(5px);
        }

        .content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .profile-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid var(--light);
        }

        .profile-pic {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--gradient);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: white;
            background-size: cover;
            background-position: center;
            border: 5px solid white;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }

        .profile-pic::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            transform: rotate(30deg);
            transition: all 0.5s;
        }

        .profile-pic:hover::before {
            transform: rotate(0deg);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .feature-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 1px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.7s;
        }

        .feature-card:hover::before {
            left: 100%;
        }

        .feature-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: var(--hover-shadow);
            background: white;
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 20px;
            color: var(--primary);
            transition: all 0.3s ease;
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.2);
            color: var(--secondary);
        }

        .chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 380px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            z-index: 1000;
            overflow: hidden;
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.4s ease;
        }

        .chatbot.active {
            transform: translateY(0);
            opacity: 1;
        }

        .chatbot-header {
            background: var(--gradient);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-body {
            height: 350px;
            padding: 20px;
            overflow-y: auto;
            background: var(--light);
        }

        .chatbot-input {
            display: flex;
            padding: 20px;
            border-top: 1px solid #e9ecef;
            background: white;
        }

        .chatbot-input input {
            flex: 1;
            margin-right: 10px;
            border-radius: 25px;
            padding: 12px 20px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
            position: relative;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background: var(--gradient);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background: white;
            color: var(--dark);
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .attendance-graph {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            box-shadow: var(--card-shadow);
        }

        .graph-bar {
            height: 35px;
            background: var(--gradient);
            margin-bottom: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            color: white;
            font-weight: 600;
            transition: width 0.8s ease;
            position: relative;
            overflow: hidden;
        }

        .graph-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .graph-container {
            margin-top: 25px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
        }

        .graph-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1.3em;
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--light);
            position: relative;
            overflow: hidden;
        }

        .file-upload::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .file-upload:hover::before {
            left: 100%;
        }

        .file-upload:hover {
            border-color: var(--primary);
            background: rgba(255, 107, 107, 0.05);
        }

        .file-list {
            margin-top: 25px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .file-item:hover::before {
            left: 100%;
        }

        .file-item:hover {
            transform: translateX(5px);
            background: #e9ecef;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .file-icon {
            font-size: 1.5em;
            color: var(--primary);
        }

        .performance-chart {
            width: 100%;
            height: 300px;
            margin-top: 25px;
        }

        .complaint-item, .leave-request {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .complaint-item::before, .leave-request::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .complaint-item:hover::before, .leave-request:hover::before {
            left: 100%;
        }

        .complaint-item:hover, .leave-request:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .complaint-header, .leave-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            align-items: center;
        }

        .complaint-category, .leave-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .complaint-category {
            background: var(--info);
            color: white;
        }

        .status-open { background: var(--warning); color: white; }
        .status-in-progress { background: var(--info); color: white; }
        .status-resolved { background: var(--success); color: white; }
        .status-pending { background: var(--warning); color: white; }
        .status-approved { background: var(--success); color: white; }
        .status-rejected { background: var(--danger); color: white; }

        .notification-badge {
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            position: absolute;
            top: -5px;
            right: -5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .notification-item {
            padding: 18px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 10px;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
        }

        .notification-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .notification-item:hover::before {
            left: 100%;
        }

        .notification-item:hover {
            background: var(--light);
            transform: translateX(5px);
        }

        .notification-item.unread {
            background: rgba(255, 107, 107, 0.1);
            border-left: 4px solid var(--primary);
        }

        .forum-post {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .forum-post::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .forum-post:hover::before {
            left: 100%;
        }

        .forum-post:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .forum-reply {
            background: white;
            padding: 18px;
            border-radius: 10px;
            margin-top: 12px;
            border-left: 4px solid var(--primary);
        }

        .course-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }

        .course-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .course-card:hover::before {
            left: 100%;
        }

        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
            background: white;
        }

        .enrollment-status {
            background: var(--success);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            display: inline-block;
            margin-top: 12px;
        }

        .photo-upload {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--light);
            position: relative;
            overflow: hidden;
        }

        .photo-upload::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .photo-upload:hover::before {
            left: 100%;
        }

        .photo-upload:hover {
            border-color: var(--primary);
        }

        .photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            display: none;
            border: 3px solid var(--primary);
        }

        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .attendance-table th, .attendance-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .attendance-table th {
            background: var(--gradient);
            color: white;
            font-weight: 600;
        }

        .attendance-table tr:hover {
            background-color: #f8f9fa;
        }

        .student-card {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .student-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .student-card:hover::before {
            left: 100%;
        }

        .student-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .student-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .student-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
        }

        .attendance-percentage {
            font-size: 1.3em;
            font-weight: bold;
        }

        .percentage-high { color: var(--success); }
        .percentage-medium { color: var(--warning); }
        .percentage-low { color: var(--danger); }

        .timetable-image {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 25px;
        }

        .calendar-day {
            padding: 15px;
            border: 1px solid #e9ecef;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .calendar-day::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .calendar-day:hover::before {
            left: 100%;
        }

        .calendar-day:hover {
            background: var(--light);
            transform: scale(1.05);
        }

        .calendar-day.today {
            background: var(--gradient);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-class {
            background: var(--success);
            color: white;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .calendar-header div {
            padding: 12px;
            text-align: center;
            font-weight: bold;
            background: var(--dark);
            color: white;
            border-radius: 8px;
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 25px;
            color: var(--dark);
            font-weight: 700;
            border-left: 5px solid var(--primary);
            padding-left: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--gradient);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        /* Parent-Teacher Chat Styles */
        .teacher-chat {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 380px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            z-index: 1000;
            overflow: hidden;
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.4s ease;
        }

        .teacher-chat.active {
            transform: translateY(0);
            opacity: 1;
        }

        .teacher-chat-header {
            background: var(--gradient-reverse);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .teacher-chat-body {
            height: 350px;
            padding: 20px;
            overflow-y: auto;
            background: var(--light);
        }

        .teacher-chat-input {
            display: flex;
            padding: 20px;
            border-top: 1px solid #e9ecef;
            background: white;
        }

        .teacher-chat-input input {
            flex: 1;
            margin-right: 10px;
            border-radius: 25px;
            padding: 12px 20px;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
        }

        .parent-message {
            background: var(--gradient-reverse);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .teacher-message {
            background: white;
            color: var(--dark);
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chat-teacher-list {
            margin-top: 20px;
        }

        .chat-teacher-item {
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .chat-teacher-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .chat-teacher-item:hover::before {
            left: 100%;
        }

        .chat-teacher-item:hover {
            background: var(--gradient);
            color: white;
            transform: translateX(5px);
        }

        /* Performance Dashboard */
        .performance-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 25px;
        }

        .performance-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(90deg);
            transform-origin: 50% 50%;
        }

        /* Enhanced Attendance System Styles */
        .attendance-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }

        .attendance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .attendance-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .attendance-summary-card {
            flex: 1;
            background: var(--gradient);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }

        .attendance-summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .attendance-summary-card:hover::before {
            left: 100%;
        }

        .attendance-summary-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .attendance-summary-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .attendance-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .attendance-student-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .attendance-student-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .attendance-student-card:hover::before {
            left: 100%;
        }

        .attendance-student-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .student-profile-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .student-avatar-large {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5em;
            background-size: cover;
            background-position: center;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .student-details {
            flex: 1;
        }

        .student-name {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .student-email {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .student-roll {
            background: var(--light);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            display: inline-block;
        }

        .attendance-status-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .attendance-percentage-display {
            text-align: center;
        }

        .percentage-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .percentage-label {
            font-size: 0.8em;
            color: #666;
        }

        .attendance-options {
            display: flex;
            gap: 10px;
        }

        .attendance-option {
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .attendance-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .attendance-option:hover::before {
            left: 100%;
        }

        .attendance-option.present {
            background: rgba(29, 209, 161, 0.1);
            color: var(--success);
            border-color: var(--success);
        }

        .attendance-option.absent {
            background: rgba(255, 159, 243, 0.1);
            color: var(--danger);
            border-color: var(--danger);
        }

        .attendance-option.late {
            background: rgba(254, 202, 87, 0.1);
            color: var(--warning);
            border-color: var(--warning);
        }

        .attendance-option.selected {
            background: var(--gradient);
            color: white;
            border-color: var(--primary);
        }

        .attendance-option:hover:not(.selected) {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .attendance-bulk-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }

        .attendance-date-picker {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--light);
            padding: 12px 15px;
            border-radius: 10px;
        }

        .attendance-date-picker input {
            background: transparent;
            border: none;
            padding: 0;
            width: auto;
        }

        .attendance-stats {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .attendance-stat {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: var(--light);
        }

        .attendance-stat-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .attendance-stat-label {
            font-size: 0.8em;
            color: #666;
        }

        /* Results Section Styles */
        .results-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }

        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: var(--gradient);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .result-card:hover::before {
            left: 100%;
        }

        .result-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .result-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .results-table th, .results-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .results-table th {
            background: var(--gradient);
            color: white;
            font-weight: 600;
        }

        .results-table tr:hover {
            background-color: #f8f9fa;
        }

        .grade-A { color: #1dd1a1; font-weight: bold; }
        .grade-B { color: #54a0ff; font-weight: bold; }
        .grade-C { color: #feca57; font-weight: bold; }
        .grade-D { color: #ff9ff3; font-weight: bold; }
        .grade-F { color: #ff6b6b; font-weight: bold; }

        /* Overall Performance Styles */
        .performance-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 25px;
        }

        .performance-chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
        }

        .chart-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--dark);
            font-weight: 600;
            font-size: 1.2em;
        }

        .chart-placeholder {
            height: 250px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 1.1em;
        }

        /* Events and Fests Styles */
        .events-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }

        .event-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }

        .event-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .event-card:hover::before {
            left: 100%;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
            background: white;
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .event-title {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--primary);
        }

        .event-date {
            background: var(--gradient);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .event-description {
            margin-bottom: 15px;
            color: #666;
        }

        .event-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Live Sessions Styles */
        .live-sessions-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }

        .live-session-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }

        .live-session-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .live-session-card:hover::before {
            left: 100%;
        }

        .live-session-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
            background: white;
        }

        .live-session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .live-session-title {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--primary);
        }

        .live-session-time {
            background: var(--gradient);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .live-session-description {
            margin-bottom: 15px;
            color: #666;
        }

        .live-session-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Question Papers Section */
        .question-papers-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }

        .question-paper-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }

        .question-paper-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .question-paper-card:hover::before {
            left: 100%;
        }

        .question-paper-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
            background: white;
        }

        .question-paper-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-paper-title {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--primary);
        }

        .question-paper-year {
            background: var(--gradient);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .question-paper-description {
            margin-bottom: 15px;
            color: #666;
        }

        .question-paper-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Holiday Calendar Styles */
        .holiday-calendar-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }

        .holiday-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 25px;
        }

        .holiday-day {
            padding: 15px;
            border: 1px solid #e9ecef;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .holiday-day::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .holiday-day:hover::before {
            left: 100%;
        }

        .holiday-day:hover {
            background: var(--light);
            transform: scale(1.05);
        }

        .holiday-day.today {
            background: var(--gradient);
            color: white;
            font-weight: bold;
        }

        .holiday-day.holiday {
            background: var(--danger);
            color: white;
        }

        .holiday-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .holiday-header div {
            padding: 12px;
            text-align: center;
            font-weight: bold;
            background: var(--dark);
            color: white;
            border-radius: 8px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
            }
            
            .performance-dashboard {
                grid-template-columns: 1fr;
            }
            
            .attendance-summary {
                flex-direction: column;
            }
            
            .performance-charts {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .chatbot, .teacher-chat {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }
            
            .attendance-student-card {
                flex-direction: column;
            }
            
            .attendance-status-section {
                flex-direction: column;
                gap: 15px;
            }
            
            .attendance-options {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Parent Portal Specific Styles */
        .parent-portal .sidebar-menu li:not(:nth-child(-n+6)) {
            display: none;
        }

        .chat-option {
            background: var(--gradient-reverse);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .chat-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .chat-option:hover::before {
            left: 100%;
        }

        .chat-option:hover {
            background: var(--gradient);
            transform: translateY(-3px);
        }

        /* Enhanced Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .slide-in-left {
            animation: slideInLeft 0.5s ease-out;
        }

        .slide-in-right {
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Sparkle Cursor */
        .sparkle-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ff6b6b, #4ecdc4, #ff9ff3);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            mix-blend-mode: difference;
            transition: transform 0.15s ease;
            box-shadow: 0 0 10px #ff6b6b, 0 0 20px #4ecdc4, 0 0 30px #ff9ff3;
        }

        .sparkle-cursor-follower {
            position: fixed;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, rgba(255, 107, 107, 0.3), rgba(78, 205, 196, 0.3), rgba(255, 159, 243, 0.3));
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            transition: transform 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }

        /* Floating Elements */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0% { transform: translate(0, 0px); }
            50% { transform: translate(0, 15px); }
            100% { transform: translate(0, -0px); }
        }

        /* Glassmorphism Effect */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        /* 3D Card Effect */
        .card-3d {
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .card-3d:hover {
            transform: rotateY(5deg) rotateX(5deg);
        }

        /* 3D Bubble Background */
        .bubbles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }

        .bubble {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: float 15s infinite linear;
            box-shadow: inset 0 0 20px rgba(255,255,255,0.2);
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0) scale(0.5);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100px) translateX(calc(100vw - 100px)) scale(1.5);
                opacity: 0;
            }
        }

        /* Online Students Indicator */
        .online-indicator {
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .online-students-list {
            margin-top: 15px;
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
        }

        .online-student-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Leaderboard Styles */
        .leaderboard-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            background: var(--light);
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .leaderboard-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.1), transparent);
            transition: left 0.5s;
        }

        .leaderboard-item:hover::before {
            left: 100%;
        }

        .leaderboard-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .leaderboard-rank {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 1.2em;
        }

        .leaderboard-rank-1 {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }

        .leaderboard-rank-2 {
            background: linear-gradient(135deg, #C0C0C0 0%, #A9A9A9 100%);
        }

        .leaderboard-rank-3 {
            background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
        }

        .leaderboard-student-info {
            flex: 1;
        }

        .leaderboard-student-name {
            font-weight: 600;
            font-size: 1.1em;
        }

        .leaderboard-student-credits {
            color: var(--success);
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Theme Switcher */
        .theme-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .theme-btn {
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            transform: scale(1.1);
        }

        .theme-options {
            position: absolute;
            top: 60px;
            right: 0;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--card-shadow);
            display: none;
            flex-direction: column;
            gap: 10px;
            min-width: 150px;
        }

        .theme-options.active {
            display: flex;
        }

        .theme-option {
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-option:hover {
            background: var(--light);
        }

        .theme-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        /* AI Study Assistant Styles */
        .ai-assistant-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
        }

        .ai-response {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }

        .course-recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recommendation-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .concept-map {
            width: 100%;
            height: 400px;
            background: var(--light);
            border-radius: 12px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- 3D Bubble Background -->
    <div class="bubbles" id="bubbles"></div>

    <!-- Sparkle Cursor -->
    <div class="sparkle-cursor" id="cursor"></div>
    <div class="sparkle-cursor-follower" id="cursor-follower"></div>

    <!-- Theme Switcher -->
    <div class="theme-switcher">
        <button class="theme-btn" onclick="toggleThemeOptions()">
            <i class="fas fa-palette"></i>
        </button>
        <div class="theme-options" id="themeOptions">
            <div class="theme-option" onclick="changeTheme('default')">
                <div class="theme-color" style="background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);"></div>
                <span>Default</span>
            </div>
            <div class="theme-option" onclick="changeTheme('dark')">
                <div class="theme-color" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);"></div>
                <span>Dark</span>
            </div>
            <div class="theme-option" onclick="changeTheme('ocean')">
                <div class="theme-color" style="background: linear-gradient(135deg, #1a2a6c 0%, #b21f1f 100%);"></div>
                <span>Ocean</span>
            </div>
            <div class="theme-option" onclick="changeTheme('forest')">
                <div class="theme-color" style="background: linear-gradient(135deg, #2e8b57 0%, #228b22 100%);"></div>
                <span>Forest</span>
            </div>
            <div class="theme-option" onclick="changeTheme('sunset')">
                <div class="theme-color" style="background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);"></div>
                <span>Sunset</span>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-graduation-cap"></i> EduPortal</h1>
            <p>Comprehensive Student & Teacher Management System</p>
        </div>

        <!-- Login Section -->
        <div id="loginSection" class="card card-3d">
            <div class="tabs">
                <div class="tab active" data-tab="student"><i class="fas fa-user-graduate"></i> Student Login</div>
                <div class="tab" data-tab="teacher"><i class="fas fa-chalkboard-teacher"></i> Teacher Login</div>
                <div class="tab" data-tab="parent"><i class="fas fa-users"></i> Parent Login</div>
                <div class="tab" data-tab="register"><i class="fas fa-user-plus"></i> Register</div>
            </div>
            
            <div id="loginForm">
                <h2 style="text-align: center; margin-bottom: 30px;" id="loginTitle"><i class="fas fa-user-graduate"></i> Student Login</h2>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                <button class="btn btn-primary" onclick="login()" style="width: 100%;"><i class="fas fa-sign-in-alt"></i> Login</button>
            </div>

            <div id="registerForm" class="hidden">
                <h2 style="text-align: center; margin-bottom: 30px;"><i class="fas fa-user-plus"></i> Register New Account</h2>
                <div class="form-group">
                    <label><i class="fas fa-user-tag"></i> Account Type</label>
                    <select id="registerType" onchange="toggleRegisterFields()">
                        <option value="student">Student</option>
                        <option value="teacher">Teacher</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Full Name</label>
                    <input type="text" id="registerName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="registerEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="registerPassword" placeholder="Create a password">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-building"></i> Department</label>
                    <select id="registerDepartment">
                        <option value="computer_science">Computer Science</option>
                        <option value="electrical">Electrical Engineering</option>
                        <option value="mechanical">Mechanical Engineering</option>
                        <option value="civil">Civil Engineering</option>
                        <option value="business">Business Administration</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-camera"></i> Profile Photo</label>
                    <div class="photo-upload" onclick="document.getElementById('registerPhoto').click()">
                        <img id="photoPreview" class="photo-preview">
                        <p><i class="fas fa-cloud-upload-alt"></i> Click to upload profile photo</p>
                        <input type="file" id="registerPhoto" class="hidden" accept="image/*" onchange="previewPhoto(event)">
                    </div>
                </div>
                <div id="studentFields">
                    <div class="form-group">
                        <label><i class="fas fa-user-friends"></i> Father's Name</label>
                        <input type="text" id="registerFatherName" placeholder="Enter father's name">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-id-card"></i> Roll Number (Optional)</label>
                        <input type="text" id="registerRollNumber" placeholder="Leave blank for auto-generation">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Parent Email</label>
                        <input type="email" id="registerParentEmail" placeholder="Enter parent's email for parent portal">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-lock"></i> Parent Password</label>
                        <input type="password" id="registerParentPassword" placeholder="Create password for parent portal">
                    </div>
                </div>
                <div id="teacherFields" class="hidden">
                    <div class="form-group">
                        <label><i class="fas fa-book"></i> Subject</label>
                        <input type="text" id="registerSubject" placeholder="Enter your subject">
                    </div>
                </div>
                <button class="btn btn-success" onclick="register()" style="width: 100%;"><i class="fas fa-user-plus"></i> Register</button>
                <p style="text-align: center; margin-top: 15px;">
                    Already have an account? <a href="#" onclick="showLoginForm('student')">Login here</a>
                </p>
            </div>
        </div>

        <!-- Student Dashboard -->
        <div id="studentDashboard" class="hidden">
            <div class="dashboard">
                <div class="sidebar">
                    <div class="profile-pic" id="studentProfilePic" style="position: relative;">
                        <i class="fas fa-user-graduate"></i>
                        <div id="studentNotificationBadge" class="notification-badge hidden">0</div>
                    </div>
                    <h3 id="studentName" style="text-align: center; margin-bottom: 20px;"></h3>
                    <ul class="sidebar-menu">
                        <li class="active" onclick="showStudentSection('profile')"><i class="fas fa-user"></i> Profile</li>
                        <li onclick="showStudentSection('courses')"><i class="fas fa-book"></i> Available Courses</li>
                        <li onclick="showStudentSection('myCourses')"><i class="fas fa-graduation-cap"></i> My Courses</li>
                        <li onclick="showStudentSection('attendance')"><i class="fas fa-calendar-check"></i> Attendance</li>
                        <li onclick="showStudentSection('results')"><i class="fas fa-chart-line"></i> Results</li>
                        <li onclick="showStudentSection('assignments')"><i class="fas fa-tasks"></i> Assignments</li>
                        <li onclick="showStudentSection('timetable')"><i class="fas fa-calendar-alt"></i> Timetable</li>
                        <li onclick="showStudentSection('liveSessions')"><i class="fas fa-video"></i> Live Sessions</li>
                        <li onclick="showStudentSection('events')"><i class="fas fa-calendar-day"></i> Events & Fests</li>
                        <li onclick="showStudentSection('forum')"><i class="fas fa-comments"></i> Discussion Forum</li>
                        <li onclick="showStudentSection('leave')"><i class="fas fa-calendar-times"></i> Request Leave</li>
                        <li onclick="showStudentSection('mockTests')"><i class="fas fa-file-alt"></i> Mock Tests</li>
                        <li onclick="showStudentSection('questionPapers')"><i class="fas fa-file-pdf"></i> Question Papers</li>
                        <li onclick="showStudentSection('holidayCalendar')"><i class="fas fa-calendar"></i> Holiday Calendar</li>
                        <li onclick="showStudentSection('complaints')"><i class="fas fa-exclamation-circle"></i> Raise Complaint</li>
                        <li onclick="showStudentSection('leaderboard')"><i class="fas fa-trophy"></i> Leaderboard</li>
                        <li onclick="showStudentSection('aiAssistant')"><i class="fas fa-robot"></i> AI Study Assistant</li>
                        <li onclick="showStudentSection('notifications')"><i class="fas fa-bell"></i> Notifications</li>
                        <li onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</li>
                    </ul>
                </div>
                <div class="content">
                    <div id="studentProfile" class="student-section">
                        <h2 class="section-title">Student Profile</h2>
                        <div class="profile-header">
                            <div class="profile-pic" id="studentProfilePicLarge"><i class="fas fa-user-graduate"></i></div>
                            <h3 id="studentProfileName"></h3>
                            <p id="studentProfileEmail"></p>
                            <p id="studentProfileDepartment"></p>
                            <p id="studentProfileRollNumber"></p>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="studentCoursesCount">0</div>
                                <div class="stat-label">Enrolled Courses</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="studentAttendancePercent">0%</div>
                                <div class="stat-label">Overall Attendance</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="studentAssignmentsCount">0</div>
                                <div class="stat-label">Pending Assignments</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="studentCredits">0</div>
                                <div class="stat-label">Performance Credits</div>
                            </div>
                        </div>
                        <div class="grid">
                            <div class="feature-card" onclick="showStudentSection('courses')">
                                <div class="feature-icon"><i class="fas fa-book"></i></div>
                                <h3>Available Courses</h3>
                                <p>Browse and enroll in available courses</p>
                            </div>
                            <div class="feature-card" onclick="showStudentSection('myCourses')">
                                <div class="feature-icon"><i class="fas fa-graduation-cap"></i></div>
                                <h3>My Courses</h3>
                                <p>View your enrolled courses</p>
                            </div>
                            <div class="feature-card" onclick="showStudentSection('attendance')">
                                <div class="feature-icon"><i class="fas fa-calendar-check"></i></div>
                                <h3>Attendance</h3>
                                <p>View your attendance records and statistics</p>
                            </div>
                            <div class="feature-card" onclick="showStudentSection('results')">
                                <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
                                <h3>Results</h3>
                                <p>Check your grades and performance</p>
                            </div>
                            <div class="feature-card" onclick="showStudentSection('assignments')">
                                <div class="feature-icon"><i class="fas fa-tasks"></i></div>
                                <h3>Assignments</h3>
                                <p>Submit and track assignments</p>
                            </div>
                            <div class="feature-card" onclick="showStudentSection('liveSessions')">
                                <div class="feature-icon"><i class="fas fa-video"></i></div>
                                <h3>Live Sessions</h3>
                                <p>Join live classes and interactive sessions</p>
                            </div>
                            <div class="feature-card" onclick="showStudentSection('events')">
                                <div class="feature-icon"><i class="fas fa-calendar-day"></i></div>
                                <h3>Events & Fests</h3>
                                <p>View and participate in college events</p>
                            </div>
                            <div class="feature-card" onclick="showStudentSection('aiAssistant')">
                                <div class="feature-icon"><i class="fas fa-robot"></i></div>
                                <h3>AI Study Assistant</h3>
                                <p>Get personalized learning support</p>
                            </div>
                        </div>
                    </div>

                    <div id="studentCourses" class="student-section hidden">
                        <h2 class="section-title">Available Courses</h2>
                        <div id="availableCoursesContent"></div>
                    </div>

                    <div id="studentMyCourses" class="student-section hidden">
                        <h2 class="section-title">My Enrolled Courses</h2>
                        <div id="enrolledCoursesContent"></div>
                    </div>

                    <div id="studentAttendance" class="student-section hidden">
                        <h2 class="section-title">Attendance Records</h2>
                        <div class="attendance-graph">
                            <h3>Attendance Overview</h3>
                            <div id="attendanceGraph"></div>
                        </div>
                        <div class="graph-container">
                            <h3 class="graph-title">Subject-wise Attendance</h3>
                            <div id="subjectAttendanceGraph"></div>
                        </div>
                    </div>

                    <div id="studentResults" class="student-section hidden">
                        <h2 class="section-title">Academic Results</h2>
                        <div class="results-container">
                            <div class="results-summary">
                                <div class="result-card">
                                    <div class="result-value" id="overallGPA">0.0</div>
                                    <div class="result-label">Overall GPA</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="totalSubjects">0</div>
                                    <div class="result-label">Total Subjects</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="passedSubjects">0</div>
                                    <div class="result-label">Passed Subjects</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="semesterRank">-</div>
                                    <div class="result-label">Semester Rank</div>
                                </div>
                            </div>
                            <h3>Detailed Results</h3>
                            <div id="resultsContent"></div>
                        </div>
                    </div>

                    <div id="studentAssignments" class="student-section hidden">
                        <h2 class="section-title">Assignments</h2>
                        <div id="assignmentsContent"></div>
                    </div>

                    <div id="studentTimetable" class="student-section hidden">
                        <h2 class="section-title">Class Timetable</h2>
                        <div id="timetableContent"></div>
                    </div>

                    <div id="studentLiveSessions" class="student-section hidden">
                        <h2 class="section-title">Live Sessions</h2>
                        <div class="live-sessions-container">
                            <div id="liveSessionsContent"></div>
                        </div>
                    </div>

                    <div id="studentEvents" class="student-section hidden">
                        <h2 class="section-title">Events & Fests</h2>
                        <div id="eventsContent"></div>
                    </div>

                    <div id="studentForum" class="student-section hidden">
                        <h2 class="section-title">Discussion Forum</h2>
                        <div class="form-group">
                            <label>Select Course</label>
                            <select id="forumCourseSelect" onchange="loadForumPosts()">
                                <option value="">Select a course</option>
                            </select>
                        </div>
                        <div id="forumContent"></div>
                    </div>

                    <div id="studentLeave" class="student-section hidden">
                        <h2 class="section-title">Request Leave</h2>
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" id="leaveStartDate">
                        </div>
                        <div class="form-group">
                            <label>End Date</label>
                            <input type="date" id="leaveEndDate">
                        </div>
                        <div class="form-group">
                            <label>Reason</label>
                            <textarea id="leaveReason" placeholder="Enter reason for leave"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Upload Supporting Document (Optional)</label>
                            <div class="file-upload" onclick="document.getElementById('leaveDocument').click()">
                                <p><i class="fas fa-cloud-upload-alt"></i> Click to upload supporting document</p>
                                <input type="file" id="leaveDocument" class="hidden" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                            </div>
                            <div id="leaveDocumentPreview" class="file-list"></div>
                        </div>
                        <button class="btn btn-primary" onclick="submitLeaveRequest()">Submit Request</button>
                    </div>

                    <div id="studentMockTests" class="student-section hidden">
                        <h2 class="section-title">Mock Tests</h2>
                        <div class="form-group">
                            <label>Select Subject</label>
                            <select id="testSubject">
                                <option value="mathematics">Mathematics</option>
                                <option value="physics">Physics</option>
                                <option value="programming">Programming</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="generateTest()">Generate Test</button>
                    </div>

                    <div id="studentQuestionPapers" class="student-section hidden">
                        <h2 class="section-title">Question Papers</h2>
                        <div class="question-papers-container">
                            <div id="questionPapersContent"></div>
                        </div>
                    </div>

                    <div id="studentHolidayCalendar" class="student-section hidden">
                        <h2 class="section-title">Holiday Calendar</h2>
                        <div class="holiday-calendar-container">
                            <div id="holidayCalendarContent"></div>
                        </div>
                    </div>

                    <div id="studentComplaints" class="student-section hidden">
                        <h2 class="section-title">Raise Complaint</h2>
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="complaintTitle" placeholder="Enter complaint title">
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <select id="complaintCategory">
                                <option value="academic">Academic</option>
                                <option value="infrastructure">Infrastructure</option>
                                <option value="faculty">Faculty</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="complaintDescription" placeholder="Describe your complaint in detail"></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="submitComplaint()">Submit Complaint</button>
                    </div>

                    <div id="studentLeaderboard" class="student-section hidden">
                        <h2 class="section-title">Monthly Leaderboard</h2>
                        <div class="leaderboard-container">
                            <div id="leaderboardContent"></div>
                        </div>
                    </div>

                    <div id="studentAiAssistant" class="student-section hidden">
                        <h2 class="section-title">AI Study Assistant</h2>
                        <div class="ai-assistant-container">
                            <div class="form-group">
                                <label>Ask a question about your courses</label>
                                <textarea id="aiQuestion" placeholder="Ask anything related to your courses, assignments, or concepts you're studying..." rows="4"></textarea>
                            </div>
                            <button class="btn btn-primary" onclick="askAI()"><i class="fas fa-robot"></i> Ask AI Assistant</button>
                            <div id="aiResponse" class="ai-response hidden"></div>
                            
                            <h3 style="margin-top: 30px;">Course Recommendations</h3>
                            <div id="courseRecommendations" class="course-recommendations"></div>
                            
                            <h3 style="margin-top: 30px;">Concept Map</h3>
                            <div class="concept-map">
                                <p>Visual representation of course topics and their relationships</p>
                            </div>
                        </div>
                    </div>

                    <div id="studentNotifications" class="student-section hidden">
                        <h2 class="section-title">Notifications</h2>
                        <div id="notificationsContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Dashboard -->
        <div id="teacherDashboard" class="hidden">
            <div class="dashboard">
                <div class="sidebar">
                    <div class="profile-pic" id="teacherProfilePic" style="position: relative;">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <div id="teacherNotificationBadge" class="notification-badge hidden">0</div>
                    </div>
                    <h3 id="teacherName" style="text-align: center; margin-bottom: 20px;"></h3>
                    <ul class="sidebar-menu">
                        <li class="active" onclick="showTeacherSection('profile')"><i class="fas fa-user"></i> Profile</li>
                        <li onclick="showTeacherSection('courses')"><i class="fas fa-plus-circle"></i> Create Course</li>
                        <li onclick="showTeacherSection('myCourses')"><i class="fas fa-book"></i> My Courses</li>
                        <li onclick="showTeacherSection('attendance')"><i class="fas fa-calendar-check"></i> Report Attendance</li>
                        <li onclick="showTeacherSection('performance')"><i class="fas fa-chart-line"></i> Student Performance</li>
                        <li onclick="showTeacherSection('grades')"><i class="fas fa-upload"></i> Upload Grades</li>
                        <li onclick="showTeacherSection('assignments')"><i class="fas fa-tasks"></i> Upload Assignments</li>
                        <li onclick="showTeacherSection('submissions')"><i class="fas fa-inbox"></i> Assignment Submissions</li>
                        <li onclick="showTeacherSection('timetable')"><i class="fas fa-calendar-alt"></i> Upload Timetable</li>
                        <li onclick="showTeacherSection('liveSessions')"><i class="fas fa-video"></i> Live Sessions</li>
                        <li onclick="showTeacherSection('events')"><i class="fas fa-calendar-day"></i> Manage Events</li>
                        <li onclick="showTeacherSection('questionPapers')"><i class="fas fa-file-pdf"></i> Upload Question Papers</li>
                        <li onclick="showTeacherSection('holidayCalendar')"><i class="fas fa-calendar"></i> Holiday Calendar</li>
                        <li onclick="showTeacherSection('leaderboard')"><i class="fas fa-trophy"></i> Manage Leaderboard</li>
                        <li onclick="showTeacherSection('forum')"><i class="fas fa-comments"></i> Discussion Forum</li>
                        <li onclick="showTeacherSection('complaints')"><i class="fas fa-exclamation-circle"></i> Student Complaints</li>
                        <li onclick="showTeacherSection('notifications')"><i class="fas fa-bell"></i> Notifications</li>
                        <li onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</li>
                    </ul>
                </div>
                <div class="content">
                    <div id="teacherProfile" class="teacher-section">
                        <h2 class="section-title">Teacher Profile</h2>
                        <div class="profile-header">
                            <div class="profile-pic" id="teacherProfilePicLarge"><i class="fas fa-chalkboard-teacher"></i></div>
                            <h3 id="teacherProfileName"></h3>
                            <p id="teacherProfileEmail"></p>
                            <p id="teacherProfileDepartment"></p>
                            <p id="teacherProfileSubject"></p>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="teacherCoursesCount">0</div>
                                <div class="stat-label">Created Courses</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="teacherStudentsCount">0</div>
                                <div class="stat-label">Total Students</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="teacherAssignmentsCount">0</div>
                                <div class="stat-label">Active Assignments</div>
                            </div>
                        </div>
                        <div class="grid">
                            <div class="feature-card" onclick="showTeacherSection('courses')">
                                <div class="feature-icon"><i class="fas fa-plus-circle"></i></div>
                                <h3>Create Course</h3>
                                <p>Create and manage courses</p>
                            </div>
                            <div class="feature-card" onclick="showTeacherSection('myCourses')">
                                <div class="feature-icon"><i class="fas fa-book"></i></div>
                                <h3>My Courses</h3>
                                <p>View your created courses</p>
                            </div>
                            <div class="feature-card" onclick="showTeacherSection('attendance')">
                                <div class="feature-icon"><i class="fas fa-calendar-check"></i></div>
                                <h3>Report Attendance</h3>
                                <p>Mark and manage student attendance</p>
                            </div>
                            <div class="feature-card" onclick="showTeacherSection('liveSessions')">
                                <div class="feature-icon"><i class="fas fa-video"></i></div>
                                <h3>Live Sessions</h3>
                                <p>Schedule and conduct live classes</p>
                            </div>
                            <div class="feature-card" onclick="showTeacherSection('events')">
                                <div class="feature-icon"><i class="fas fa-calendar-day"></i></div>
                                <h3>Manage Events</h3>
                                <p>Create and manage college events</p>
                            </div>
                            <div class="feature-card" onclick="showTeacherSection('leaderboard')">
                                <div class="feature-icon"><i class="fas fa-trophy"></i></div>
                                <h3>Leaderboard</h3>
                                <p>Manage monthly student rankings</p>
                            </div>
                        </div>
                    </div>

                    <div id="teacherCourses" class="teacher-section hidden">
                        <h2 class="section-title">Create New Course</h2>
                        <div class="form-group">
                            <label>Course Name</label>
                            <input type="text" id="courseName" placeholder="Enter course name">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="courseDescription" placeholder="Enter course description"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Duration</label>
                            <input type="text" id="courseDuration" placeholder="e.g., 1 semester, 3 months">
                        </div>
                        <div class="form-group">
                            <label>Upload Materials</label>
                            <div class="file-upload" onclick="document.getElementById('courseFile').click()">
                                <p><i class="fas fa-cloud-upload-alt"></i> Click to upload course materials</p>
                                <input type="file" id="courseFile" class="hidden" multiple onchange="handleCourseFileUpload(this)">
                            </div>
                            <div id="courseFilesList" class="file-list"></div>
                        </div>
                        <button class="btn btn-primary" onclick="createCourse()">Create Course</button>
                    </div>

                    <div id="teacherMyCourses" class="teacher-section hidden">
                        <h2 class="section-title">My Created Courses</h2>
                        <div id="teacherCoursesContent"></div>
                    </div>

                    <!-- Enhanced Attendance Section -->
                    <div id="teacherAttendance" class="teacher-section hidden">
                        <h2 class="section-title">Report Attendance</h2>
                        <div class="attendance-container">
                            <div class="attendance-header">
                                <div>
                                    <h3>Mark Student Attendance</h3>
                                    <p>Select a course and date to mark attendance</p>
                                </div>
                                <div class="attendance-date-picker">
                                    <i class="fas fa-calendar-alt"></i>
                                    <input type="date" id="attendanceDate" value="">
                                </div>
                            </div>
                            
                            <div class="attendance-controls">
                                <div class="form-group" style="flex: 1;">
                                    <label>Select Course</label>
                                    <select id="attendanceCourse" onchange="loadCourseStudents()">
                                        <option value="">Select a course</option>
                                    </select>
                                </div>
                                <div class="attendance-bulk-actions">
                                    <button class="btn btn-success" onclick="markAllPresent()"><i class="fas fa-check-circle"></i> Mark All Present</button>
                                    <button class="btn btn-danger" onclick="markAllAbsent()"><i class="fas fa-times-circle"></i> Mark All Absent</button>
                                </div>
                            </div>
                            
                            <div id="courseStudentsList" class="attendance-students-list"></div>
                            
                            <div class="attendance-stats">
                                <div class="attendance-stat">
                                    <div class="attendance-stat-value" id="totalStudents">0</div>
                                    <div class="attendance-stat-label">Total Students</div>
                                </div>
                                <div class="attendance-stat">
                                    <div class="attendance-stat-value" id="presentCount">0</div>
                                    <div class="attendance-stat-label">Present</div>
                                </div>
                                <div class="attendance-stat">
                                    <div class="attendance-stat-value" id="absentCount">0</div>
                                    <div class="attendance-stat-label">Absent</div>
                                </div>
                                <div class="attendance-stat">
                                    <div class="attendance-stat-value" id="lateCount">0</div>
                                    <div class="attendance-stat-label">Late</div>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 25px;">
                                <button class="btn btn-primary" onclick="recordAttendance()" style="padding: 15px 30px; font-size: 1.1em;">
                                    <i class="fas fa-save"></i> Save Attendance Records
                                </button>
                            </div>
                        </div>
                        
                        <div id="leaveRequestsSection" class="hidden" style="margin-top: 30px;">
                            <h3>Pending Leave Requests</h3>
                            <div id="leaveRequestsList"></div>
                        </div>
                    </div>

                    <div id="teacherPerformance" class="teacher-section hidden">
                        <h2 class="section-title">Student Performance</h2>
                        <div class="form-group">
                            <label>Select Student</label>
                            <select id="performanceStudent" onchange="loadStudentPerformance()">
                                <option value="">Select a student</option>
                            </select>
                        </div>
                        <div id="performanceContent"></div>
                    </div>

                    <div id="teacherGrades" class="teacher-section hidden">
                        <h2 class="section-title">Upload Grades</h2>
                        <div class="form-group">
                            <label>Select Student</label>
                            <select id="gradeStudent">
                                <option value="">Select a student</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Course</label>
                            <input type="text" id="gradeCourse" placeholder="Enter course name">
                        </div>
                        <div class="form-group">
                            <label>Assignment</label>
                            <select id="gradeAssignment">
                                <option value="">Select assignment</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Grade</label>
                            <input type="text" id="studentGrade" placeholder="Enter grade (A, B, C, etc.)">
                        </div>
                        <div class="form-group">
                            <label>Semester</label>
                            <input type="text" id="gradeSemester" placeholder="Enter semester">
                        </div>
                        <button class="btn btn-primary" onclick="uploadGrade()">Upload Grade</button>
                    </div>

                    <div id="teacherAssignments" class="teacher-section hidden">
                        <h2 class="section-title">Upload Assignment</h2>
                        <div class="form-group">
                            <label>Assignment Title</label>
                            <input type="text" id="assignmentTitle" placeholder="Enter assignment title">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="assignmentDescription" placeholder="Enter assignment description"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Due Date</label>
                            <input type="date" id="assignmentDueDate">
                        </div>
                        <div class="form-group">
                            <label>Course</label>
                            <select id="assignmentCourse">
                                <option value="">Select course</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Upload Assignment File</label>
                            <div class="file-upload" onclick="document.getElementById('assignmentFile').click()">
                                <p><i class="fas fa-cloud-upload-alt"></i> Click to upload assignment file</p>
                                <input type="file" id="assignmentFile" class="hidden" multiple onchange="handleAssignmentFileUpload(this)">
                            </div>
                            <div id="assignmentFilesList" class="file-list"></div>
                        </div>
                        <button class="btn btn-primary" onclick="uploadAssignment()">Upload Assignment</button>
                    </div>

                    <div id="teacherSubmissions" class="teacher-section hidden">
                        <h2 class="section-title">Assignment Submissions</h2>
                        <div class="form-group">
                            <label>Select Assignment</label>
                            <select id="submissionAssignment" onchange="loadAssignmentSubmissions()">
                                <option value="">Select assignment</option>
                            </select>
                        </div>
                        <div id="submissionsContent"></div>
                    </div>

                    <div id="teacherTimetable" class="teacher-section hidden">
                        <h2 class="section-title">Upload Timetable</h2>
                        <div class="form-group">
                            <label>Department</label>
                            <select id="timetableDepartment">
                                <option value="computer_science">Computer Science</option>
                                <option value="electrical">Electrical Engineering</option>
                                <option value="mechanical">Mechanical Engineering</option>
                                <option value="civil">Civil Engineering</option>
                                <option value="business">Business Administration</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <input type="text" id="timetableDescription" placeholder="e.g., Spring 2024 Timetable">
                        </div>
                        <div class="form-group">
                            <label>Upload Timetable Image</label>
                            <div class="file-upload" onclick="document.getElementById('timetableFile').click()">
                                <p><i class="fas fa-cloud-upload-alt"></i> Click to upload timetable image (JPG, PNG)</p>
                                <input type="file" id="timetableFile" class="hidden" accept="image/*" onchange="previewTimetable(event)">
                            </div>
                            <img id="timetablePreview" class="timetable-image hidden" style="max-width: 100%; margin-top: 15px;">
                        </div>
                        <button class="btn btn-primary" onclick="uploadTimetable()">Upload Timetable</button>
                    </div>

                    <div id="teacherLiveSessions" class="teacher-section hidden">
                        <h2 class="section-title">Live Sessions</h2>
                        <div class="form-group">
                            <label>Session Title</label>
                            <input type="text" id="liveSessionTitle" placeholder="Enter session title">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="liveSessionDescription" placeholder="Enter session description"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Schedule Date & Time</label>
                            <input type="datetime-local" id="liveSessionDateTime">
                        </div>
                        <div class="form-group">
                            <label>Duration (minutes)</label>
                            <input type="number" id="liveSessionDuration" placeholder="Enter duration in minutes">
                        </div>
                        <div class="form-group">
                            <label>Course</label>
                            <select id="liveSessionCourse">
                                <option value="">Select course</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Meeting Link</label>
                            <input type="url" id="liveSessionLink" placeholder="Enter meeting link (Zoom, Google Meet, etc.)">
                        </div>
                        <button class="btn btn-primary" onclick="createLiveSession()">Create Live Session</button>
                        
                        <div style="margin-top: 40px;">
                            <h3>Online Students</h3>
                            <div id="onlineStudentsList" class="online-students-list">
                                <div class="online-student-item">
                                    <span class="online-indicator"></span>
                                    <span>John Doe (CS001)</span>
                                </div>
                                <div class="online-student-item">
                                    <span class="online-indicator"></span>
                                    <span>Jane Smith (CS002)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 40px;">
                            <h3>Scheduled Live Sessions</h3>
                            <div id="scheduledLiveSessionsContent"></div>
                        </div>
                    </div>

                    <div id="teacherEvents" class="teacher-section hidden">
                        <h2 class="section-title">Manage Events & Fests</h2>
                        <div class="form-group">
                            <label>Event Title</label>
                            <input type="text" id="eventTitle" placeholder="Enter event title">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="eventDescription" placeholder="Enter event description"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Event Date</label>
                            <input type="date" id="eventDate">
                        </div>
                        <div class="form-group">
                            <label>Event Type</label>
                            <select id="eventType">
                                <option value="fest">College Fest</option>
                                <option value="technical">Technical Event</option>
                                <option value="cultural">Cultural Event</option>
                                <option value="sports">Sports Event</option>
                                <option value="workshop">Workshop</option>
                                <option value="seminar">Seminar</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Upload Event Materials (PDF, Links, etc.)</label>
                            <div class="file-upload" onclick="document.getElementById('eventFile').click()">
                                <p><i class="fas fa-cloud-upload-alt"></i> Click to upload event materials</p>
                                <input type="file" id="eventFile" class="hidden" multiple onchange="handleEventFileUpload(this)">
                            </div>
                            <div id="eventFilesList" class="file-list"></div>
                        </div>
                        <div class="form-group">
                            <label>Registration Link (Optional)</label>
                            <input type="url" id="eventRegistrationLink" placeholder="Enter registration link">
                        </div>
                        <button class="btn btn-primary" onclick="createEvent()">Create Event</button>
                        
                        <div style="margin-top: 40px;">
                            <h3>Existing Events</h3>
                            <div id="existingEventsContent"></div>
                        </div>
                    </div>

                    <div id="teacherQuestionPapers" class="teacher-section hidden">
                        <h2 class="section-title">Upload Question Papers</h2>
                        <div class="form-group">
                            <label>Question Paper Title</label>
                            <input type="text" id="questionPaperTitle" placeholder="Enter question paper title">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="questionPaperDescription" placeholder="Enter question paper description"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Course</label>
                            <select id="questionPaperCourse">
                                <option value="">Select course</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Year</label>
                            <input type="text" id="questionPaperYear" placeholder="Enter year (e.g., 2023)">
                        </div>
                        <div class="form-group">
                            <label>Upload Question Paper</label>
                            <div class="file-upload" onclick="document.getElementById('questionPaperFile').click()">
                                <p><i class="fas fa-cloud-upload-alt"></i> Click to upload question paper (PDF)</p>
                                <input type="file" id="questionPaperFile" class="hidden" accept=".pdf" onchange="handleQuestionPaperFileUpload(this)">
                            </div>
                            <div id="questionPaperFilesList" class="file-list"></div>
                        </div>
                        <button class="btn btn-primary" onclick="uploadQuestionPaper()">Upload Question Paper</button>
                        
                        <div style="margin-top: 40px;">
                            <h3>Uploaded Question Papers</h3>
                            <div id="uploadedQuestionPapersContent"></div>
                        </div>
                    </div>

                    <div id="teacherHolidayCalendar" class="teacher-section hidden">
                        <h2 class="section-title">Holiday Calendar</h2>
                        <div class="holiday-calendar-container">
                            <div id="holidayCalendarContent"></div>
                        </div>
                    </div>

                    <div id="teacherLeaderboard" class="teacher-section hidden">
                        <h2 class="section-title">Monthly Leaderboard</h2>
                        <div class="leaderboard-container">
                            <div class="form-group">
                                <label>Select Month</label>
                                <select id="leaderboardMonth" onchange="loadLeaderboard()">
                                    <option value="1">January</option>
                                    <option value="2">February</option>
                                    <option value="3">March</option>
                                    <option value="4">April</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">August</option>
                                    <option value="9">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Select Year</label>
                                <select id="leaderboardYear" onchange="loadLeaderboard()">
                                    <option value="2024">2024</option>
                                    <option value="2023">2023</option>
                                </select>
                            </div>
                            <div id="leaderboardManagementContent"></div>
                        </div>
                    </div>

                    <div id="teacherForum" class="teacher-section hidden">
                        <h2 class="section-title">Discussion Forum</h2>
                        <div class="form-group">
                            <label>Select Course</label>
                            <select id="teacherForumCourseSelect" onchange="loadTeacherForumPosts()">
                                <option value="">Select a course</option>
                            </select>
                        </div>
                        <div id="teacherForumContent"></div>
                    </div>

                    <div id="teacherComplaints" class="teacher-section hidden">
                        <h2 class="section-title">Student Complaints</h2>
                        <div id="complaintsList"></div>
                    </div>

                    <div id="teacherNotifications" class="teacher-section hidden">
                        <h2 class="section-title">Notifications</h2>
                        <div id="teacherNotificationsContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Parent Dashboard -->
        <div id="parentDashboard" class="hidden parent-portal">
            <div class="dashboard">
                <div class="sidebar">
                    <div class="profile-pic" id="parentProfilePic" style="position: relative;">
                        <i class="fas fa-users"></i>
                        <div id="parentNotificationBadge" class="notification-badge hidden">0</div>
                    </div>
                    <h3 id="parentName" style="text-align: center; margin-bottom: 20px;"></h3>
                    <ul class="sidebar-menu">
                        <li class="active" onclick="showParentSection('profile')"><i class="fas fa-user"></i> Profile</li>
                        <li onclick="showParentSection('studentInfo')"><i class="fas fa-user-graduate"></i> Student Information</li>
                        <li onclick="showParentSection('attendance')"><i class="fas fa-calendar-check"></i> Attendance</li>
                        <li onclick="showParentSection('results')"><i class="fas fa-chart-line"></i> Results</li>
                        <li onclick="showParentSection('timetable')"><i class="fas fa-calendar-alt"></i> Timetable</li>
                        <li onclick="showParentSection('performance')"><i class="fas fa-chart-bar"></i> Overall Performance</li>
                        <li onclick="showParentSection('leaderboard')"><i class="fas fa-trophy"></i> Leaderboard</li>
                        <li onclick="showParentSection('notifications')"><i class="fas fa-bell"></i> Notifications</li>
                        <li onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</li>
                    </ul>
                    <div class="chat-option" onclick="toggleTeacherChat()">
                        <i class="fas fa-comments"></i> Parent-Teacher Chat
                    </div>
                </div>
                <div class="content">
                    <div id="parentProfile" class="parent-section">
                        <h2 class="section-title">Parent Profile</h2>
                        <div class="profile-header">
                            <div class="profile-pic" id="parentProfilePicLarge"><i class="fas fa-users"></i></div>
                            <h3 id="parentProfileName"></h3>
                            <p id="parentProfileEmail"></p>
                        </div>
                        <div class="grid">
                            <div class="feature-card" onclick="showParentSection('studentInfo')">
                                <div class="feature-icon"><i class="fas fa-user-graduate"></i></div>
                                <h3>Student Information</h3>
                                <p>View your child's academic details</p>
                            </div>
                            <div class="feature-card" onclick="showParentSection('attendance')">
                                <div class="feature-icon"><i class="fas fa-calendar-check"></i></div>
                                <h3>Attendance</h3>
                                <p>Monitor your child's attendance</p>
                            </div>
                            <div class="feature-card" onclick="showParentSection('results')">
                                <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
                                <h3>Results</h3>
                                <p>Check your child's academic performance</p>
                            </div>
                            <div class="feature-card" onclick="showParentSection('timetable')">
                                <div class="feature-icon"><i class="fas fa-calendar-alt"></i></div>
                                <h3>Timetable</h3>
                                <p>View your child's class schedule</p>
                            </div>
                            <div class="feature-card" onclick="showParentSection('performance')">
                                <div class="feature-icon"><i class="fas fa-chart-bar"></i></div>
                                <h3>Overall Performance</h3>
                                <p>Comprehensive performance analytics</p>
                            </div>
                            <div class="feature-card" onclick="showParentSection('leaderboard')">
                                <div class="feature-icon"><i class="fas fa-trophy"></i></div>
                                <h3>Leaderboard</h3>
                                <p>View your child's ranking</p>
                            </div>
                            <div class="feature-card" onclick="toggleTeacherChat()">
                                <div class="feature-icon"><i class="fas fa-comments"></i></div>
                                <h3>Teacher Chat</h3>
                                <p>Communicate with teachers</p>
                            </div>
                        </div>
                    </div>

                    <div id="parentStudentInfo" class="parent-section hidden">
                        <h2 class="section-title">Student Information</h2>
                        <div id="studentInfoContent"></div>
                    </div>

                    <div id="parentAttendance" class="parent-section hidden">
                        <h2 class="section-title">Student Attendance</h2>
                        <div id="parentAttendanceContent"></div>
                    </div>

                    <div id="parentResults" class="parent-section hidden">
                        <h2 class="section-title">Student Results</h2>
                        <div class="results-container">
                            <div class="results-summary">
                                <div class="result-card">
                                    <div class="result-value" id="parentOverallGPA">0.0</div>
                                    <div class="result-label">Overall GPA</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="parentTotalSubjects">0</div>
                                    <div class="result-label">Total Subjects</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="parentPassedSubjects">0</div>
                                    <div class="result-label">Passed Subjects</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="parentSemesterRank">-</div>
                                    <div class="result-label">Semester Rank</div>
                                </div>
                            </div>
                            <h3>Detailed Results</h3>
                            <div id="parentResultsContent"></div>
                        </div>
                    </div>

                    <div id="parentTimetable" class="parent-section hidden">
                        <h2 class="section-title">Student Timetable</h2>
                        <div id="parentTimetableContent"></div>
                    </div>

                    <div id="parentPerformance" class="parent-section hidden">
                        <h2 class="section-title">Overall Performance</h2>
                        <div class="performance-dashboard">
                            <div class="performance-card">
                                <h3>Attendance Summary</h3>
                                <div id="parentAttendanceSummary"></div>
                            </div>
                            <div class="performance-card">
                                <h3>Grade Distribution</h3>
                                <div id="parentGradeDistribution"></div>
                            </div>
                            <div class="performance-card" style="grid-column: span 2;">
                                <h3>Performance Trends</h3>
                                <div class="performance-charts">
                                    <div class="performance-chart-container">
                                        <div class="chart-title">Academic Progress</div>
                                        <div class="chart-placeholder">
                                            <i class="fas fa-chart-line"></i> Academic Progress Chart
                                        </div>
                                    </div>
                                    <div class="performance-chart-container">
                                        <div class="chart-title">Subject-wise Performance</div>
                                        <div class="chart-placeholder">
                                            <i class="fas fa-chart-bar"></i> Subject Performance Chart
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="parentLeaderboard" class="parent-section hidden">
                        <h2 class="section-title">Student Leaderboard</h2>
                        <div class="leaderboard-container">
                            <div id="parentLeaderboardContent"></div>
                        </div>
                    </div>

                    <div id="parentNotifications" class="parent-section hidden">
                        <h2 class="section-title">Notifications</h2>
                        <div id="parentNotificationsContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chatbot -->
    <div id="chatbot" class="chatbot hidden">
        <div class="chatbot-header">
            <h3><i class="fas fa-robot"></i> AI Learning Assistant</h3>
            <button class="btn btn-light btn-sm" onclick="toggleChatbot()"><i class="fas fa-times"></i></button>
        </div>
        <div class="chatbot-body" id="chatbotMessages">
            <div class="message bot-message">
                Hello! I'm your AI learning assistant. How can I help you today?
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbotInput" placeholder="Ask me anything...">
            <button class="btn btn-primary" onclick="sendChatMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- Teacher-Parent Chat -->
    <div id="teacherChat" class="teacher-chat hidden">
        <div class="teacher-chat-header">
            <h3><i class="fas fa-comments"></i> Teacher Chat</h3>
            <button class="btn btn-light btn-sm" onclick="toggleTeacherChat()"><i class="fas fa-times"></i></button>
        </div>
        <div class="teacher-chat-body" id="teacherChatMessages">
            <div class="chat-message teacher-message">
                Welcome to parent-teacher communication. Select a teacher to start chatting.
            </div>
        </div>
        <div class="chat-teacher-list" id="teacherList">
            <!-- Teachers will be loaded here -->
        </div>
        <div class="teacher-chat-input hidden" id="teacherChatInput">
            <input type="text" id="teacherChatInputField" placeholder="Type your message...">
            <button class="btn btn-primary" onclick="sendTeacherMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <button class="btn btn-primary floating" onclick="toggleChatbot()" style="position: fixed; bottom: 20px; right: 20px; z-index: 999; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
        <i class="fas fa-robot"></i>
    </button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // 3D Bubble background implementation
        document.addEventListener('DOMContentLoaded', function() {
            const bubblesContainer = document.getElementById('bubbles');
            const bubbleCount = 20;
            
            for (let i = 0; i < bubbleCount; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                
                // Random size between 50 and 200px
                const size = Math.random() * 150 + 50;
                bubble.style.width = size + 'px';
                bubble.style.height = size + 'px';
                
                // Random position
                bubble.style.left = Math.random() * 100 + 'vw';
                
                // Random animation delay
                bubble.style.animationDelay = Math.random() * 15 + 's';
                
                // Random animation duration
                bubble.style.animationDuration = (Math.random() * 10 + 10) + 's';
                
                bubblesContainer.appendChild(bubble);
            }
            
            // Sparkle cursor implementation
            const cursor = document.getElementById('cursor');
            const cursorFollower = document.getElementById('cursor-follower');
            
            document.addEventListener('mousemove', function(e) {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
                
                setTimeout(function() {
                    cursorFollower.style.left = e.clientX + 'px';
                    cursorFollower.style.top = e.clientY + 'px';
                }, 100);
            });
            
            // Add hover effects for interactive elements
            const interactiveElements = document.querySelectorAll('button, .card, .feature-card, .sidebar-menu li, .tab, .file-upload, .chat-option');
            
            interactiveElements.forEach(element => {
                element.addEventListener('mouseenter', function() {
                    cursor.style.transform = 'scale(1.5)';
                    cursorFollower.style.transform = 'scale(1.2)';
                });
                
                element.addEventListener('mouseleave', function() {
                    cursor.style.transform = 'scale(1)';
                    cursorFollower.style.transform = 'scale(1)';
                });
            });

            // Tab click handlers
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabType = this.getAttribute('data-tab');
                    if (tabType === 'register') {
                        showRegisterForm();
                    } else {
                        showLoginForm(tabType);
                    }
                });
            });
        });

        // Theme switching functionality
        function toggleThemeOptions() {
            const themeOptions = document.getElementById('themeOptions');
            themeOptions.classList.toggle('active');
        }

        function changeTheme(themeName) {
            const root = document.documentElement;
            
            switch(themeName) {
                case 'dark':
                    root.style.setProperty('--primary', '#2c3e50');
                    root.style.setProperty('--secondary', '#34495e');
                    root.style.setProperty('--success', '#27ae60');
                    root.style.setProperty('--warning', '#f39c12');
                    root.style.setProperty('--danger', '#e74c3c');
                    root.style.setProperty('--info', '#3498db');
                    root.style.setProperty('--light', '#ecf0f1');
                    root.style.setProperty('--dark', '#2c3e50');
                    document.body.style.background = 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)';
                    break;
                case 'ocean':
                    root.style.setProperty('--primary', '#1a2a6c');
                    root.style.setProperty('--secondary', '#b21f1f');
                    root.style.setProperty('--success', '#1dd1a1');
                    root.style.setProperty('--warning', '#feca57');
                    root.style.setProperty('--danger', '#ff6b6b');
                    root.style.setProperty('--info', '#54a0ff');
                    root.style.setProperty('--light', '#f7f7f7');
                    root.style.setProperty('--dark', '#222f3e');
                    document.body.style.background = 'linear-gradient(135deg, #1a2a6c 0%, #b21f1f 100%)';
                    break;
                case 'forest':
                    root.style.setProperty('--primary', '#2e8b57');
                    root.style.setProperty('--secondary', '#228b22');
                    root.style.setProperty('--success', '#32cd32');
                    root.style.setProperty('--warning', '#ffd700');
                    root.style.setProperty('--danger', '#dc143c');
                    root.style.setProperty('--info', '#1e90ff');
                    root.style.setProperty('--light', '#f0fff0');
                    root.style.setProperty('--dark', '#2f4f4f');
                    document.body.style.background = 'linear-gradient(135deg, #2e8b57 0%, #228b22 100%)';
                    break;
                case 'sunset':
                    root.style.setProperty('--primary', '#ff6b6b');
                    root.style.setProperty('--secondary', '#ffa500');
                    root.style.setProperty('--success', '#32cd32');
                    root.style.setProperty('--warning', '#ffd700');
                    root.style.setProperty('--danger', '#dc143c');
                    root.style.setProperty('--info', '#1e90ff');
                    root.style.setProperty('--light', '#fffaf0');
                    root.style.setProperty('--dark', '#2f4f4f');
                    document.body.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%)';
                    break;
                default: // default theme
                    root.style.setProperty('--primary', '#ff6b6b');
                    root.style.setProperty('--secondary', '#4ecdc4');
                    root.style.setProperty('--success', '#1dd1a1');
                    root.style.setProperty('--warning', '#feca57');
                    root.style.setProperty('--danger', '#ff9ff3');
                    root.style.setProperty('--info', '#54a0ff');
                    root.style.setProperty('--light', '#f7f7f7');
                    root.style.setProperty('--dark', '#222f3e');
                    document.body.style.background = 'linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d)';
            }
            
            // Close theme options
            document.getElementById('themeOptions').classList.remove('active');
        }

        // Global variables
        let currentUser = null;
        let currentUserType = null;
        let courseFiles = [];
        let assignmentFiles = [];
        let eventFiles = [];
        let questionPaperFiles = [];
        let leaveDocument = null;
        let socket = null;
        let selectedTeacher = null;
        let attendanceData = {};

        // Global variables for data storage
        let enrollments = [];
        let forumPosts = [];
        let notifications = [];
        let assignments = [];
        let courses = [];
        let timetables = [];
        let events = [];
        let liveSessions = [];
        let questionPapers = [];
        let leaderboard = [];

        // Form visibility functions
        function showLoginForm(type) {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${type}"]`).classList.add('active');
            
            const titleMap = {
                'student': 'Student Login',
                'teacher': 'Teacher Login',
                'parent': 'Parent Login'
            };
            document.getElementById('loginTitle').textContent = titleMap[type] || 'Login';
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('.tab[data-tab="register"]').classList.add('active');
            toggleRegisterFields();
        }

        function toggleRegisterFields() {
            const type = document.getElementById('registerType').value;
            if (type === 'student') {
                document.getElementById('studentFields').classList.remove('hidden');
                document.getElementById('teacherFields').classList.add('hidden');
            } else {
                document.getElementById('studentFields').classList.add('hidden');
                document.getElementById('teacherFields').classList.remove('hidden');
            }
        }

        function previewPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photoPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    document.querySelector('.photo-upload p').style.display = 'none';
                }
                reader.readAsDataURL(file);
            }
        }

        function previewTimetable(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('timetablePreview');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        }

        // Authentication functions
        async function register() {
            try {
                const formData = new FormData();
                formData.append('type', document.getElementById('registerType').value);
                formData.append('name', document.getElementById('registerName').value);
                formData.append('email', document.getElementById('registerEmail').value);
                formData.append('password', document.getElementById('registerPassword').value);
                formData.append('department', document.getElementById('registerDepartment').value);
                
                const photoInput = document.getElementById('registerPhoto');
                if (photoInput.files[0]) {
                    formData.append('photo', photoInput.files[0]);
                }
                
                if (document.getElementById('registerType').value === 'student') {
                    formData.append('fatherName', document.getElementById('registerFatherName').value);
                    formData.append('rollNumber', document.getElementById('registerRollNumber').value);
                    formData.append('parentEmail', document.getElementById('registerParentEmail').value);
                    formData.append('parentPassword', document.getElementById('registerParentPassword').value);
                } else {
                    formData.append('subject', document.getElementById('registerSubject').value);
                }

                const response = await fetch('/api/register', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    showLoginForm(document.getElementById('registerType').value);
                }
            } catch (error) {
                alert('Registration failed: ' + error.message);
            }
        }

        async function login() {
            const loginData = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            };

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(loginData)
                });

                const result = await response.json();
                if (result.success) {
                    currentUser = result.user;
                    currentUserType = result.user.type;
                    showDashboard();
                } else {
                    alert(result.message);
                }
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        function showDashboard() {
            document.getElementById('loginSection').classList.add('hidden');
            
            // Initialize socket connection
            socket = io();
            socket.emit('join-user', currentUser.email);
            
            socket.on('notification', (notification) => {
                updateNotificationBadge();
                if (currentUserType === 'student') {
                    loadStudentNotifications();
                } else if (currentUserType === 'teacher') {
                    loadTeacherNotifications();
                } else if (currentUserType === 'parent') {
                    loadParentNotifications();
                }
            });

            socket.on('new-chat-message', (message) => {
                if (currentUserType === 'parent' || currentUserType === 'teacher') {
                    displayChatMessage(message);
                }
            });

            if (currentUserType === 'student') {
                document.getElementById('studentDashboard').classList.remove('hidden');
                loadStudentProfile();
                updateNotificationBadge();
                loadStudentNotifications();
                loadStudentLiveSessions();
                loadStudentQuestionPapers();
                loadStudentHolidayCalendar();
                loadStudentLeaderboard();
                loadCourseRecommendations();
            } else if (currentUserType === 'teacher') {
                document.getElementById('teacherDashboard').classList.remove('hidden');
                loadTeacherProfile();
                loadTeacherStudents();
                loadTeacherComplaints();
                updateNotificationBadge();
                loadTeacherNotifications();
                loadTeacherCourses();
                loadTeacherAssignments();
                loadTeacherLiveSessions();
                loadTeacherQuestionPapers();
                loadTeacherHolidayCalendar();
                loadLeaderboard();
            } else if (currentUserType === 'parent') {
                document.getElementById('parentDashboard').classList.remove('hidden');
                loadParentProfile();
                updateNotificationBadge();
                loadParentNotifications();
                loadParentTeachers();
                loadParentLeaderboard();
            }
        }

        function logout() {
            currentUser = null;
            currentUserType = null;
            if (socket) {
                socket.disconnect();
            }
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('studentDashboard').classList.add('hidden');
            document.getElementById('teacherDashboard').classList.add('hidden');
            document.getElementById('parentDashboard').classList.add('hidden');
        }

        // Student functions
        function loadStudentProfile() {
            document.getElementById('studentName').textContent = currentUser.name;
            const profilePic = document.getElementById('studentProfilePic');
            const profilePicLarge = document.getElementById('studentProfilePicLarge');
            
            if (currentUser.photo) {
                profilePic.style.backgroundImage = `url(${currentUser.photo})`;
                profilePic.textContent = '';
                profilePicLarge.style.backgroundImage = `url(${currentUser.photo})`;
                profilePicLarge.textContent = '';
            } else {
                profilePic.textContent = currentUser.name.charAt(0);
                profilePicLarge.textContent = currentUser.name.charAt(0);
            }
            
            document.getElementById('studentProfileName').textContent = currentUser.name;
            document.getElementById('studentProfileEmail').textContent = currentUser.email;
            document.getElementById('studentProfileDepartment').textContent = "Department: " + currentUser.department.replace('_', ' ').toUpperCase();
            document.getElementById('studentProfileRollNumber').textContent = "Roll Number: " + currentUser.rollNumber;

            // Load stats
            loadStudentStats();
        }

        async function loadStudentStats() {
            try {
                // Load enrolled courses count
                const coursesResponse = await fetch(`/api/enrolled-courses/${currentUser.email}`);
                const coursesResult = await coursesResponse.json();
                if (coursesResult.success) {
                    document.getElementById('studentCoursesCount').textContent = coursesResult.courses.length;
                }

                // Load attendance percentage
                const attendanceResponse = await fetch(`/api/attendance/${currentUser.email}`);
                const attendanceResult = await attendanceResponse.json();
                if (attendanceResult.success && attendanceResult.attendance.length > 0) {
                    const presentCount = attendanceResult.attendance.filter(a => a.status === 'present').length;
                    const totalCount = attendanceResult.attendance.length;
                    const percentage = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                    document.getElementById('studentAttendancePercent').textContent = percentage + '%';
                }

                // Load assignments count
                const assignmentsResponse = await fetch(`/api/assignments/${currentUser.department}`);
                const assignmentsResult = await assignmentsResponse.json();
                if (assignmentsResult.success) {
                    document.getElementById('studentAssignmentsCount').textContent = assignmentsResult.assignments.length;
                }

                // Load credits
                const creditsResponse = await fetch(`/api/student-credits/${currentUser.email}`);
                const creditsResult = await creditsResponse.json();
                if (creditsResult.success) {
                    document.getElementById('studentCredits').textContent = creditsResult.credits;
                }
            } catch (error) {
                console.error('Error loading student stats:', error);
            }
        }

        function showStudentSection(section) {
            document.querySelectorAll('.student-section').forEach(sec => sec.classList.add('hidden'));
            document.getElementById('student' + section.charAt(0).toUpperCase() + section.slice(1)).classList.remove('hidden');
            
            document.querySelectorAll('.sidebar-menu li').forEach(li => li.classList.remove('active'));
            event.currentTarget.classList.add('active');

            if (section === 'courses') loadAvailableCourses();
            if (section === 'myCourses') loadEnrolledCourses();
            if (section === 'attendance') loadStudentAttendance();
            if (section === 'results') loadStudentResults();
            if (section === 'assignments') loadStudentAssignments();
            if (section === 'timetable') loadStudentTimetable();
            if (section === 'liveSessions') loadStudentLiveSessions();
            if (section === 'events') loadStudentEvents();
            if (section === 'forum') loadStudentForum();
            if (section === 'questionPapers') loadStudentQuestionPapers();
            if (section === 'holidayCalendar') loadStudentHolidayCalendar();
            if (section === 'leaderboard') loadStudentLeaderboard();
            if (section === 'aiAssistant') loadCourseRecommendations();
            if (section === 'notifications') loadStudentNotifications();
        }

        async function loadAvailableCourses() {
            try {
                const response = await fetch('/api/all-courses');
                const result = await response.json();
                
                let html = '<div class="grid">';
                if (result.success && result.courses.length > 0) {
                    // Get enrolled courses
                    const enrolledResponse = await fetch(`/api/enrolled-courses/${currentUser.email}`);
                    const enrolledResult = await enrolledResponse.json();
                    const enrolledCourseIds = enrolledResult.success ? enrolledResult.courses.map(c => c.id) : [];
                    
                    result.courses.forEach(course => {
                        const isEnrolled = enrolledCourseIds.includes(course.id);
                        
                        html += `
                            <div class="course-card">
                                <h3>${course.courseName}</h3>
                                <p><strong>Teacher:</strong> ${course.teacherEmail}</p>
                                <p><strong>Duration:</strong> ${course.duration}</p>
                                <p>${course.description}</p>
                                ${isEnrolled ? 
                                    '<span class="enrollment-status">Enrolled</span>' :
                                    `<button class="btn btn-primary" onclick="enrollInCourse('${course.id}')">Enroll</button>`
                                }
                            </div>
                        `;
                    });
                } else {
                    html += '<p>No courses available at the moment.</p>';
                }
                html += '</div>';
                document.getElementById('availableCoursesContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading available courses:', error);
                document.getElementById('availableCoursesContent').innerHTML = '<p>Error loading courses</p>';
            }
        }

        async function enrollInCourse(courseId) {
            try {
                const response = await fetch('/api/enroll', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        studentEmail: currentUser.email,
                        courseId: courseId
                    })
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    loadAvailableCourses();
                    loadEnrolledCourses();
                    loadStudentStats();
                }
            } catch (error) {
                alert('Enrollment failed: ' + error.message);
            }
        }

        async function loadEnrolledCourses() {
            try {
                const response = await fetch(`/api/enrolled-courses/${currentUser.email}`);
                const result = await response.json();
                
                let html = '<div class="grid">';
                if (result.success && result.courses.length > 0) {
                    result.courses.forEach(course => {
                        html += `
                            <div class="course-card">
                                <h3>${course.courseName}</h3>
                                <p><strong>Teacher:</strong> ${course.teacherEmail}</p>
                                <p><strong>Duration:</strong> ${course.duration}</p>
                                <p>${course.description}</p>
                                <p><strong>Enrolled on:</strong> ${new Date(course.enrolledDate).toLocaleDateString()}</p>
                                <div class="file-list">
                                    ${course.files && course.files.length > 0 ? 
                                        course.files.map(file => `
                                            <div class="file-item">
                                                <div class="file-info">
                                                    <span class="file-icon"></span>
                                                    <span>${file.name}</span>
                                                </div>
                                                <button class="btn btn-primary btn-sm" onclick="downloadFile('${file.url}', '${file.name}')">Download</button>
                                            </div>
                                        `).join('') : 
                                        '<p>No course materials available.</p>'
                                    }
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<p>You are not enrolled in any courses yet.</p>';
                }
                html += '</div>';
                document.getElementById('enrolledCoursesContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading enrolled courses:', error);
                document.getElementById('enrolledCoursesContent').innerHTML = '<p>Error loading enrolled courses</p>';
            }
        }

        async function loadStudentAttendance() {
            try {
                const response = await fetch(`/api/attendance/${currentUser.email}`);
                const result = await response.json();
                
                if (result.success) {
                    const graph = document.getElementById('attendanceGraph');
                    const subjectGraph = document.getElementById('subjectAttendanceGraph');
                    graph.innerHTML = '';
                    subjectGraph.innerHTML = '';
                    
                    // Group by course
                    const courseData = {};
                    
                    result.attendance.forEach(record => {
                        if (!courseData[record.course]) {
                            courseData[record.course] = { present: 0, total: 0 };
                        }
                        courseData[record.course].total++;
                        if (record.status === 'present') courseData[record.course].present++;
                    });

                    // Overall attendance
                    let totalPresent = 0;
                    let totalClasses = 0;
                    
                    for (const [course, data] of Object.entries(courseData)) {
                        totalPresent += data.present;
                        totalClasses += data.total;
                        const percentage = (data.present / data.total) * 100;
                        const bar = document.createElement('div');
                        bar.className = 'graph-bar';
                        bar.style.width = `${percentage}%`;
                        bar.textContent = `${course}: ${percentage.toFixed(1)}% (${data.present}/${data.total})`;
                        graph.appendChild(bar);
                    }

                    // Subject-wise attendance
                    for (const [course, data] of Object.entries(courseData)) {
                        const percentage = (data.present / data.total) * 100;
                        const bar = document.createElement('div');
                        bar.className = 'graph-bar';
                        bar.style.width = `${percentage}%`;
                        bar.textContent = `${course}: ${percentage.toFixed(1)}% (${data.present}/${data.total})`;
                        subjectGraph.appendChild(bar);
                    }
                } else {
                    document.getElementById('attendanceGraph').innerHTML = '<p>No attendance records found.</p>';
                }
            } catch (error) {
                console.error('Error loading attendance:', error);
                document.getElementById('attendanceGraph').innerHTML = '<p>Error loading attendance records</p>';
            }
        }

        async function loadStudentResults() {
            try {
                const [gradesResponse, overallResponse] = await Promise.all([
                    fetch(`/api/grades/${currentUser.email}`),
                    fetch(`/api/overall-grades/${currentUser.email}`)
                ]);
                
                const gradesResult = await gradesResponse.json();
                const overallResult = await overallResponse.json();
                
                let html = '';
                if (gradesResult.success && gradesResult.grades.length > 0) {
                    // Calculate overall GPA and stats
                    let totalPoints = 0;
                    let totalSubjects = gradesResult.grades.length;
                    let passedSubjects = 0;
                    
                    const gradePoints = {
                        'A': 4.0, 'A-': 3.7, 'B+': 3.3, 'B': 3.0, 'B-': 2.7,
                        'C+': 2.3, 'C': 2.0, 'C-': 1.7, 'D+': 1.3, 'D': 1.0, 'F': 0.0
                    };
                    
                    gradesResult.grades.forEach(grade => {
                        const points = gradePoints[grade.grade] || 0;
                        totalPoints += points;
                        if (grade.grade !== 'F') passedSubjects++;
                    });
                    
                    const overallGPA = totalPoints / totalSubjects;
                    
                    // Update summary cards
                    document.getElementById('overallGPA').textContent = overallGPA.toFixed(2);
                    document.getElementById('totalSubjects').textContent = totalSubjects;
                    document.getElementById('passedSubjects').textContent = passedSubjects;
                    document.getElementById('semesterRank').textContent = totalSubjects > 0 ? Math.ceil(Math.random() * 50) + 1 : '-';
                    
                    // Create detailed results table
                    html = `
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Course</th>
                                    <th>Grade</th>
                                    <th>Semester</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    gradesResult.grades.forEach(grade => {
                        const status = grade.grade === 'F' ? 'Failed' : 'Passed';
                        const gradeClass = `grade-${grade.grade}`;
                        html += `
                            <tr>
                                <td>${grade.course}</td>
                                <td class="${gradeClass}">${grade.grade}</td>
                                <td>${grade.semester}</td>
                                <td>${status}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                            </tbody>
                        </table>
                    `;
                } else {
                    html = '<p>No grades available yet.</p>';
                }
                document.getElementById('resultsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading results:', error);
                document.getElementById('resultsContent').innerHTML = '<p>Error loading results</p>';
            }
        }

        async function loadStudentAssignments() {
            try {
                const response = await fetch(`/api/assignments/${currentUser.department}`);
                const result = await response.json();
                
                let html = '<div class="grid">';
                if (result.success && result.assignments.length > 0) {
                    result.assignments.forEach(assignment => {
                        let filesHtml = '';
                        if (assignment.files && assignment.files.length > 0) {
                            filesHtml = '<div class="file-list">';
                            assignment.files.forEach(file => {
                                filesHtml += `
                                    <div class="file-item">
                                        <div class="file-info">
                                            <span class="file-icon"></span>
                                            <span>${file.name}</span>
                                        </div>
                                        <button class="btn btn-primary btn-sm" onclick="downloadFile('${file.url}', '${file.name}')">Download</button>
                                    </div>
                                `;
                            });
                            filesHtml += '</div>';
                        }
                        
                        html += `
                            <div class="feature-card">
                                <h3>${assignment.title}</h3>
                                <p>${assignment.description}</p>
                                <p><strong>Due:</strong> ${new Date(assignment.dueDate).toLocaleDateString()}</p>
                                ${filesHtml}
                                <div class="form-group" style="margin-top: 15px;">
                                    <label>Submit Your Work</label>
                                    <input type="file" id="assignmentSubmission${assignment.id}">
                                    <button class="btn btn-success" onclick="submitAssignment('${assignment.id}')" style="margin-top: 10px;">Submit</button>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<p>No assignments available.</p>';
                }
                html += '</div>';
                document.getElementById('assignmentsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading assignments:', error);
                document.getElementById('assignmentsContent').innerHTML = '<p>Error loading assignments</p>';
            }
        }

        async function submitAssignment(assignmentId) {
            const fileInput = document.getElementById(`assignmentSubmission${assignmentId}`);
            if (fileInput.files.length === 0) {
                alert('Please select a file to submit');
                return;
            }

            const formData = new FormData();
            formData.append('assignmentId', assignmentId);
            formData.append('studentEmail', currentUser.email);
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch('/api/submit-assignment', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    fileInput.value = '';
                }
            } catch (error) {
                alert('Assignment submission failed: ' + error.message);
            }
        }

        async function loadStudentTimetable() {
            try {
                const response = await fetch(`/api/timetable/${currentUser.department}`);
                const result = await response.json();
                
                let html = '';
                if (result.success && result.timetable) {
                    html = `
                        <h3>${result.timetable.description}</h3>
                        <p><strong>Uploaded by:</strong> ${result.timetable.teacherEmail}</p>
                        <p><strong>Date:</strong> ${new Date(result.timetable.uploadedDate).toLocaleDateString()}</p>
                        ${result.timetable.image ? `<img src="${result.timetable.image}" alt="Timetable" class="timetable-image">` : '<p>No timetable image available.</p>'}
                    `;
                } else {
                    html = '<p>No timetable available for your department.</p>';
                }
                document.getElementById('timetableContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading timetable:', error);
                document.getElementById('timetableContent').innerHTML = '<p>Error loading timetable</p>';
            }
        }

        async function loadStudentLiveSessions() {
            try {
                const response = await fetch('/api/live-sessions');
                const result = await response.json();
                
                let html = '';
                if (result.success && result.liveSessions.length > 0) {
                    // Filter sessions for student's department
                    const studentSessions = result.liveSessions.filter(session => {
                        const course = courses.find(c => c.courseName === session.course);
                        return course && enrollments.some(e => e.courseId === course.id && e.studentEmail === currentUser.email);
                    });
                    
                    if (studentSessions.length > 0) {
                        studentSessions.forEach(session => {
                            const sessionDate = new Date(session.dateTime);
                            const now = new Date();
                            const isUpcoming = sessionDate > now;
                            
                            html += `
                                <div class="live-session-card">
                                    <div class="live-session-header">
                                        <h3 class="live-session-title">${session.title}</h3>
                                        <div class="live-session-time">${sessionDate.toLocaleString()}</div>
                                    </div>
                                    <div class="live-session-description">
                                        <p>${session.description}</p>
                                        <p><strong>Course:</strong> ${session.course}</p>
                                        <p><strong>Duration:</strong> ${session.duration} minutes</p>
                                        <p><strong>Status:</strong> ${isUpcoming ? 'Upcoming' : 'Completed'}</p>
                                    </div>
                                    ${isUpcoming ? `
                                        <div class="live-session-actions">
                                            <a href="${session.link}" target="_blank" class="btn btn-primary">
                                                <i class="fas fa-video"></i> Join Session
                                            </a>
                                            <button class="btn btn-info" onclick="addToCalendar('${session.title}', '${session.description}', '${session.dateTime}', ${session.duration})">
                                                <i class="fas fa-calendar-plus"></i> Add to Calendar
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                    } else {
                        html = '<p>No live sessions scheduled for your courses.</p>';
                    }
                } else {
                    html = '<p>No live sessions available at the moment.</p>';
                }
                document.getElementById('liveSessionsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading live sessions:', error);
                document.getElementById('liveSessionsContent').innerHTML = '<p>Error loading live sessions</p>';
            }
        }

        async function loadStudentEvents() {
            try {
                const response = await fetch('/api/events');
                const result = await response.json();
                
                let html = '<div class="events-container">';
                if (result.success && result.events.length > 0) {
                    result.events.forEach(event => {
                        html += `
                            <div class="event-card">
                                <div class="event-header">
                                    <h3 class="event-title">${event.title}</h3>
                                    <div class="event-date">${new Date(event.date).toLocaleDateString()}</div>
                                </div>
                                <div class="event-description">
                                    <p>${event.description}</p>
                                    <p><strong>Type:</strong> ${event.type}</p>
                                </div>
                                ${event.files && event.files.length > 0 ? `
                                    <div class="file-list">
                                        <h4>Event Materials:</h4>
                                        ${event.files.map(file => `
                                            <div class="file-item">
                                                <div class="file-info">
                                                    <span class="file-icon"></span>
                                                    <span>${file.name}</span>
                                                </div>
                                                <button class="btn btn-primary btn-sm" onclick="downloadFile('${file.url}', '${file.name}')">Download</button>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                ${event.registrationLink ? `
                                    <div class="event-actions">
                                        <a href="${event.registrationLink}" target="_blank" class="btn btn-primary">
                                            <i class="fas fa-external-link-alt"></i> Register Now
                                        </a>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    });
                } else {
                    html += '<p>No events available at the moment.</p>';
                }
                html += '</div>';
                document.getElementById('eventsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading events:', error);
                document.getElementById('eventsContent').innerHTML = '<p>Error loading events</p>';
            }
        }

        async function loadStudentForum() {
            try {
                const response = await fetch(`/api/enrolled-courses/${currentUser.email}`);
                const result = await response.json();
                
                const courseSelect = document.getElementById('forumCourseSelect');
                courseSelect.innerHTML = '<option value="">Select a course</option>';
                
                if (result.success && result.courses.length > 0) {
                    result.courses.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course.id;
                        option.textContent = course.courseName;
                        courseSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading forum courses:', error);
            }
        }

        async function loadForumPosts() {
            const courseId = document.getElementById('forumCourseSelect').value;
            if (!courseId) return;

            try {
                const response = await fetch(`/api/forum-posts/${courseId}`);
                const result = await response.json();
                
                let html = '';
                if (result.success && result.posts.length > 0) {
                    result.posts.forEach(post => {
                        html += `
                            <div class="forum-post">
                                <h4>${post.title}</h4>
                                <p><strong>By:</strong> ${post.userEmail}</p>
                                <p>${post.content}</p>
                                <p><small>Posted: ${new Date(post.createdDate).toLocaleString()}</small></p>
                                
                                <div class="forum-replies">
                                    <h5>Replies (${post.replies.length}):</h5>
                                    ${post.replies.map(reply => `
                                        <div class="forum-reply">
                                            <p><strong>${reply.userEmail}:</strong> ${reply.content}</p>
                                            <p><small>${new Date(reply.createdDate).toLocaleString()}</small></p>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                <div class="form-group" style="margin-top: 15px;">
                                    <textarea id="replyContent${post.id}" placeholder="Write your reply..."></textarea>
                                    <button class="btn btn-primary" onclick="postReply('${post.id}')">Post Reply</button>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html = '<p>No discussions yet. Start the first one!</p>';
                }
                
                html += `
                    <div class="forum-post">
                        <h4>Start New Discussion</h4>
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="newPostTitle" placeholder="Enter discussion title">
                        </div>
                        <div class="form-group">
                            <label>Content</label>
                            <textarea id="newPostContent" placeholder="Write your discussion content..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="createForumPost('${courseId}')">Create Post</button>
                    </div>
                `;
                
                document.getElementById('forumContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading forum posts:', error);
                document.getElementById('forumContent').innerHTML = '<p>Error loading forum posts</p>';
            }
        }

        async function createForumPost(courseId) {
            const title = document.getElementById('newPostTitle').value;
            const content = document.getElementById('newPostContent').value;
            
            if (!title || !content) {
                alert('Please fill in both title and content');
                return;
            }

            try {
                const response = await fetch('/api/forum-posts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userEmail: currentUser.email,
                        courseId: courseId,
                        title: title,
                        content: content
                    })
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    loadForumPosts();
                }
            } catch (error) {
                alert('Forum post creation failed: ' + error.message);
            }
        }

        async function postReply(postId) {
            const content = document.getElementById(`replyContent${postId}`).value;
            
            if (!content) {
                alert('Please write a reply');
                return;
            }

            try {
                const response = await fetch('/api/forum-replies', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        postId: postId,
                        userEmail: currentUser.email,
                        content: content
                    })
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    loadForumPosts();
                }
            } catch (error) {
                alert('Reply posting failed: ' + error.message);
            }
        }

        async function submitLeaveRequest() {
            const formData = new FormData();
            formData.append('userEmail', currentUser.email);
            formData.append('type', currentUserType);
            formData.append('startDate', document.getElementById('leaveStartDate').value);
            formData.append('endDate', document.getElementById('leaveEndDate').value);
            formData.append('reason', document.getElementById('leaveReason').value);
            
            const documentInput = document.getElementById('leaveDocument');
            if (documentInput.files[0]) {
                formData.append('document', documentInput.files[0]);
            }

            try {
                const response = await fetch('/api/leave', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    document.getElementById('leaveStartDate').value = '';
                    document.getElementById('leaveEndDate').value = '';
                    document.getElementById('leaveReason').value = '';
                    document.getElementById('leaveDocument').value = '';
                    document.getElementById('leaveDocumentPreview').innerHTML = '';
                }
            } catch (error) {
                alert('Leave request failed: ' + error.message);
            }
        }

        function generateTest() {
            const subject = document.getElementById('testSubject').value;
            alert(`Mock test for ${subject} generated! This would open a test interface in a real application.`);
        }

        async function loadStudentQuestionPapers() {
            try {
                const response = await fetch('/api/question-papers');
                const result = await response.json();
                
                let html = '<div class="grid">';
                if (result.success && result.questionPapers.length > 0) {
                    result.questionPapers.forEach(paper => {
                        html += `
                            <div class="question-paper-card">
                                <div class="question-paper-header">
                                    <h3 class="question-paper-title">${paper.title}</h3>
                                    <div class="question-paper-year">${paper.year}</div>
                                </div>
                                <div class="question-paper-description">
                                    <p>${paper.description}</p>
                                    <p><strong>Course:</strong> ${paper.course}</p>
                                </div>
                                <div class="question-paper-actions">
                                    <button class="btn btn-primary" onclick="downloadFile('${paper.file.url}', '${paper.file.name}')">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<p>No question papers available at the moment.</p>';
                }
                html += '</div>';
                document.getElementById('questionPapersContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading question papers:', error);
                document.getElementById('questionPapersContent').innerHTML = '<p>Error loading question papers</p>';
            }
        }

        async function loadStudentHolidayCalendar() {
            try {
                // Generate a sample holiday calendar for the current month
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                
                // Indian holidays (sample data)
                const holidays = [
                    { day: 1, name: 'New Year' },
                    { day: 26, name: 'Republic Day' },
                    { day: 15, name: 'Holi' },
                    { day: 25, name: 'Good Friday' },
                    { day: 1, name: 'May Day' },
                    { day: 15, name: 'Independence Day' },
                    { day: 2, name: 'Gandhi Jayanti' },
                    { day: 25, name: 'Christmas' }
                ];
                
                let html = '<div class="holiday-calendar">';
                
                // Calendar header
                const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                html += '<div class="holiday-header">';
                weekdays.forEach(day => {
                    html += `<div>${day}</div>`;
                });
                html += '</div>';
                
                // Calendar days
                let dayCount = 1;
                for (let i = 0; i < 6; i++) {
                    for (let j = 0; j < 7; j++) {
                        if ((i === 0 && j < firstDay.getDay()) || dayCount > daysInMonth) {
                            html += '<div class="holiday-day"></div>';
                        } else {
                            const isToday = dayCount === now.getDate() && month === now.getMonth() && year === now.getFullYear();
                            const holiday = holidays.find(h => h.day === dayCount);
                            
                            html += `
                                <div class="holiday-day ${isToday ? 'today' : ''} ${holiday ? 'holiday' : ''}">
                                    ${dayCount}
                                    ${holiday ? `<br><small>${holiday.name}</small>` : ''}
                                </div>
                            `;
                            dayCount++;
                        }
                    }
                }
                
                html += '</div>';
                document.getElementById('holidayCalendarContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading holiday calendar:', error);
                document.getElementById('holidayCalendarContent').innerHTML = '<p>Error loading holiday calendar</p>';
            }
        }

        async function submitComplaint() {
            const complaintData = {
                studentEmail: currentUser.email,
                title: document.getElementById('complaintTitle').value,
                description: document.getElementById('complaintDescription').value,
                category: document.getElementById('complaintCategory').value
            };

            try {
                const response = await fetch('/api/complaint', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(complaintData)
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    document.getElementById('complaintTitle').value = '';
                    document.getElementById('complaintDescription').value = '';
                }
            } catch (error) {
                alert('Complaint submission failed: ' + error.message);
            }
        }

        async function loadStudentLeaderboard() {
            try {
                const response = await fetch('/api/leaderboard');
                const result = await response.json();
                
                let html = '';
                if (result.success && result.leaderboard.length > 0) {
                    result.leaderboard.forEach((student, index) => {
                        const rank = index + 1;
                        html += `
                            <div class="leaderboard-item">
                                <div class="leaderboard-rank ${rank <= 3 ? `leaderboard-rank-${rank}` : ''}">
                                    ${rank}
                                </div>
                                <div class="leaderboard-student-info">
                                    <div class="leaderboard-student-name">${student.name}</div>
                                    <div class="leaderboard-student-email">${student.email}</div>
                                </div>
                                <div class="leaderboard-student-credits">
                                    ${student.credits} Credits
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html = '<p>No leaderboard data available for this month.</p>';
                }
                document.getElementById('leaderboardContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                document.getElementById('leaderboardContent').innerHTML = '<p>Error loading leaderboard</p>';
            }
        }

        async function loadCourseRecommendations() {
            try {
                const response = await fetch(`/api/course-recommendations/${currentUser.email}`);
                const result = await response.json();
                
                let html = '';
                if (result.success && result.recommendations.length > 0) {
                    html = '<div class="course-recommendations">';
                    result.recommendations.forEach(course => {
                        html += `
                            <div class="recommendation-card">
                                <h4>${course.courseName}</h4>
                                <p>${course.description}</p>
                                <p><strong>Match Score:</strong> ${course.matchScore}%</p>
                                <button class="btn btn-primary" onclick="enrollInCourse('${course.id}')">Enroll</button>
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    html = '<p>No course recommendations available at the moment.</p>';
                }
                document.getElementById('courseRecommendations').innerHTML = html;
            } catch (error) {
                console.error('Error loading course recommendations:', error);
                document.getElementById('courseRecommendations').innerHTML = '<p>Error loading recommendations</p>';
            }
        }

        async function askAI() {
            const question = document.getElementById('aiQuestion').value.trim();
            if (!question) {
                alert('Please enter a question');
                return;
            }

            try {
                const response = await fetch('/api/ai-assistant', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        studentEmail: currentUser.email,
                        question: question
                    })
                });

                const result = await response.json();
                if (result.success) {
                    const aiResponse = document.getElementById('aiResponse');
                    aiResponse.innerHTML = `<p><strong>AI Response:</strong> ${result.response}</p>`;
                    aiResponse.classList.remove('hidden');
                } else {
                    alert('AI assistant is currently unavailable. Please try again later.');
                }
            } catch (error) {
                alert('Error connecting to AI assistant: ' + error.message);
            }
        }

        async function loadStudentNotifications() {
            try {
                const response = await fetch(`/api/notifications/${currentUser.email}`);
                const result = await response.json();
                
                let html = '';
                if (result.success && result.notifications.length > 0) {
                    result.notifications.forEach(notification => {
                        html += `
                            <div class="notification-item ${notification.read ? '' : 'unread'}" onclick="markNotificationAsRead('${notification.id}')">
                                <h4>${notification.title}</h4>
                                <p>${notification.message}</p>
                                <p><small>${new Date(notification.timestamp).toLocaleString()}</small></p>
                            </div>
                        `;
                    });
                } else {
                    html = '<p>No notifications.</p>';
                }
                document.getElementById('notificationsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading notifications:', error);
                document.getElementById('notificationsContent').innerHTML = '<p>Error loading notifications</p>';
            }
        }

        async function markNotificationAsRead(notificationId) {
            try {
                const response = await fetch('/api/notifications/mark-read', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ notificationId })
                });

                const result = await response.json();
                if (result.success) {
                    updateNotificationBadge();
                    loadStudentNotifications();
                }
            } catch (error) {
                console.error('Error marking notification as read:', error);
            }
        }

        // Teacher functions
        function loadTeacherProfile() {
            document.getElementById('teacherName').textContent = currentUser.name;
            const profilePic = document.getElementById('teacherProfilePic');
            const profilePicLarge = document.getElementById('teacherProfilePicLarge');
            
            if (currentUser.photo) {
                profilePic.style.backgroundImage = `url(${currentUser.photo})`;
                profilePic.textContent = '';
                profilePicLarge.style.backgroundImage = `url(${currentUser.photo})`;
                profilePicLarge.textContent = '';
            } else {
                profilePic.textContent = currentUser.name.charAt(0);
                profilePicLarge.textContent = currentUser.name.charAt(0);
            }
            
            document.getElementById('teacherProfileName').textContent = currentUser.name;
            document.getElementById('teacherProfileEmail').textContent = currentUser.email;
            document.getElementById('teacherProfileDepartment').textContent = "Department: " + currentUser.department.replace('_', ' ').toUpperCase();
            document.getElementById('teacherProfileSubject').textContent = "Subject: " + (currentUser.subject || 'N/A');

            // Load teacher stats
            loadTeacherStats();
        }

        async function loadTeacherStats() {
            try {
                // Load courses count
                const coursesResponse = await fetch(`/api/courses/${currentUser.department}`);
                const coursesResult = await coursesResponse.json();
                if (coursesResult.success) {
                    const teacherCourses = coursesResult.courses.filter(course => course.teacherEmail === currentUser.email);
                    document.getElementById('teacherCoursesCount').textContent = teacherCourses.length;
                }

                // Load students count
                const studentsResponse = await fetch(`/api/students/${currentUser.department}`);
                const studentsResult = await studentsResponse.json();
                if (studentsResult.success) {
                    document.getElementById('teacherStudentsCount').textContent = studentsResult.students.length;
                }

                // Load assignments count
                const assignmentsResponse = await fetch(`/api/assignments/${currentUser.department}`);
                const assignmentsResult = await assignmentsResponse.json();
                if (assignmentsResult.success) {
                    const teacherAssignments = assignmentsResult.assignments.filter(assignment => assignment.teacherEmail === currentUser.email);
                    document.getElementById('teacherAssignmentsCount').textContent = teacherAssignments.length;
                }
            } catch (error) {
                console.error('Error loading teacher stats:', error);
            }
        }

        async function loadTeacherStudents() {
            try {
                const response = await fetch(`/api/students/${currentUser.department}`);
                const result = await response.json();
                
                if (result.success) {
                    const studentSelects = document.querySelectorAll('select[id$="Student"]');
                    studentSelects.forEach(select => {
                        select.innerHTML = '<option value="">Select a student</option>';
                        result.students.forEach(student => {
                            const option = document.createElement('option');
                            option.value = student.email;
                            option.textContent = `${student.name} (${student.rollNumber})`;
                            select.appendChild(option);
                        });
                    });
                }
            } catch (error) {
                console.error('Error loading teacher students:', error);
            }
        }

        async function loadTeacherComplaints() {
            try {
                const response = await fetch(`/api/complaints/${currentUser.department}`);
                const result = await response.json();
                
                if (result.success) {
                    const complaintsList = document.getElementById('complaintsList');
                    complaintsList.innerHTML = '';
                    
                    if (result.complaints.length > 0) {
                        result.complaints.forEach(complaint => {
                            const complaintItem = document.createElement('div');
                            complaintItem.className = 'complaint-item';
                            complaintItem.innerHTML = `
                                <div class="complaint-header">
                                    <h4>${complaint.title}</h4>
                                    <div>
                                        <span class="complaint-category">${complaint.category}</span>
                                        <span class="complaint-status status-${complaint.status}">${complaint.status}</span>
                                    </div>
                                </div>
                                <p><strong>Student:</strong> ${complaint.studentEmail}</p>
                                <p>${complaint.description}</p>
                                <p><small>Submitted: ${new Date(complaint.submittedDate).toLocaleDateString()}</small></p>
                                <div class="form-group" style="margin-top: 10px;">
                                    <label>Update Status</label>
                                    <select id="status-${complaint.id}" onchange="updateComplaintStatus('${complaint.id}')">
                                        <option value="open" ${complaint.status === 'open' ? 'selected' : ''}>Open</option>
                                        <option value="in-progress" ${complaint.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                        <option value="resolved" ${complaint.status === 'resolved' ? 'selected' : ''}>Resolved</option>
                                    </select>
                                </div>
                            `;
                            complaintsList.appendChild(complaintItem);
                        });
                    } else {
                        complaintsList.innerHTML = '<p>No complaints found.</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading teacher complaints:', error);
            }
        }

        async function updateComplaintStatus(complaintId) {
            const status = document.getElementById(`status-${complaintId}`).value;
            
            try {
                const response = await fetch('/api/complaint-status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ complaintId, status })
                });

                const result = await response.json();
                if (result.success) {
                    alert('Complaint status updated successfully');
                }
            } catch (error) {
                alert('Complaint status update failed: ' + error.message);
            }
        }

        function showTeacherSection(section) {
            document.querySelectorAll('.teacher-section').forEach(sec => sec.classList.add('hidden'));
            document.getElementById('teacher' + section.charAt(0).toUpperCase() + section.slice(1)).classList.remove('hidden');
            
            document.querySelectorAll('.sidebar-menu li').forEach(li => li.classList.remove('active'));
            event.currentTarget.classList.add('active');

            if (section === 'attendance') {
                loadLeaveRequests();
                loadTeacherCoursesForAttendance();
            }
            if (section === 'performance') loadTeacherStudents();
            if (section === 'myCourses') loadTeacherCourses();
            if (section === 'submissions') loadTeacherAssignments();
            if (section === 'liveSessions') loadTeacherLiveSessions();
            if (section === 'events') {
                loadTeacherEvents();
                loadExistingEvents();
            }
            if (section === 'questionPapers') loadTeacherQuestionPapers();
            if (section === 'holidayCalendar') loadTeacherHolidayCalendar();
            if (section === 'leaderboard') loadLeaderboard();
            if (section === 'forum') loadTeacherForum();
            if (section === 'notifications') loadTeacherNotifications();
        }

        async function loadTeacherCoursesForAttendance() {
            try {
                const response = await fetch(`/api/courses/${currentUser.department}`);
                const result = await response.json();
                
                const courseSelect = document.getElementById('attendanceCourse');
                courseSelect.innerHTML = '<option value="">Select a course</option>';
                
                if (result.success && result.courses.length > 0) {
                    const teacherCourses = result.courses.filter(course => course.teacherEmail === currentUser.email);
                    teacherCourses.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course.id;
                        option.textContent = course.courseName;
                        courseSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading teacher courses for attendance:', error);
            }
        }

        // Enhanced Course Students Loading with Profile and Attendance Data
        async function loadCourseStudents() {
            const courseId = document.getElementById('attendanceCourse').value;
            const date = document.getElementById('attendanceDate').value;
            
            if (!courseId) return;

            try {
                const response = await fetch(`/api/course-students/${courseId}`);
                const result = await response.json();
                
                let html = '';
                if (result.success && result.students.length > 0) {
                    // Reset attendance data
                    attendanceData = {};
                    
                    result.students.forEach(student => {
                        // Initialize attendance status for this student
                        attendanceData[student.email] = 'present';
                        
                        // Get student's attendance percentage
                        fetch(`/api/attendance/${student.email}`)
                            .then(response => response.json())
                            .then(attendanceResult => {
                                if (attendanceResult.success) {
                                    const courseAttendance = attendanceResult.attendance.filter(a => a.course === document.getElementById('attendanceCourse').options[document.getElementById('attendanceCourse').selectedIndex].text);
                                    const presentCount = courseAttendance.filter(a => a.status === 'present').length;
                                    const totalCount = courseAttendance.length;
                                    const percentage = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                                    
                                    // Update the percentage display
                                    const percentageElement = document.getElementById(`attendance-percentage-${student.email}`);
                                    if (percentageElement) {
                                        percentageElement.textContent = `${percentage}%`;
                                        // Color code based on percentage
                                        if (percentage >= 75) {
                                            percentageElement.className = 'percentage-value percentage-high';
                                        } else if (percentage >= 50) {
                                            percentageElement.className = 'percentage-value percentage-medium';
                                        } else {
                                            percentageElement.className = 'percentage-value percentage-low';
                                        }
                                    }
                                }
                            });
                        
                        html += `
                            <div class="attendance-student-card" id="student-${student.email}">
                                <div class="student-profile-section">
                                    <div class="student-avatar-large" style="${student.photo ? `background-image: url(${student.photo})` : ''}">
                                        ${!student.photo ? student.name.charAt(0) : ''}
                                    </div>
                                    <div class="student-details">
                                        <div class="student-name">${student.name}</div>
                                        <div class="student-email">${student.email}</div>
                                        <div class="student-roll">Roll No: ${student.rollNumber}</div>
                                    </div>
                                </div>
                                
                                <div class="attendance-status-section">
                                    <div class="attendance-percentage-display">
                                        <div class="percentage-value" id="attendance-percentage-${student.email}">0%</div>
                                        <div class="percentage-label">Course Attendance</div>
                                    </div>
                                    
                                    <div class="attendance-options">
                                        <div class="attendance-option present selected" onclick="setAttendanceStatus('${student.email}', 'present')">
                                            <i class="fas fa-check-circle"></i> Present
                                        </div>
                                        <div class="attendance-option absent" onclick="setAttendanceStatus('${student.email}', 'absent')">
                                            <i class="fas fa-times-circle"></i> Absent
                                        </div>
                                        <div class="attendance-option late" onclick="setAttendanceStatus('${student.email}', 'late')">
                                            <i class="fas fa-clock"></i> Late
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    // Update stats
                    document.getElementById('totalStudents').textContent = result.students.length;
                    document.getElementById('presentCount').textContent = result.students.length;
                    document.getElementById('absentCount').textContent = '0';
                    document.getElementById('lateCount').textContent = '0';
                } else {
                    html = '<p>No students enrolled in this course.</p>';
                }
                document.getElementById('courseStudentsList').innerHTML = html;
            } catch (error) {
                console.error('Error loading course students:', error);
                document.getElementById('courseStudentsList').innerHTML = '<p>Error loading students</p>';
            }
        }

        // Set attendance status for a student
        function setAttendanceStatus(studentEmail, status) {
            attendanceData[studentEmail] = status;
            
            // Update UI
            const studentCard = document.getElementById(`student-${studentEmail}`);
            const options = studentCard.querySelectorAll('.attendance-option');
            
            options.forEach(option => {
                option.classList.remove('selected');
            });
            
            studentCard.querySelector(`.attendance-option.${status}`).classList.add('selected');
            
            // Update stats
            updateAttendanceStats();
        }

        // Update attendance statistics
        function updateAttendanceStats() {
            const total = Object.keys(attendanceData).length;
            let present = 0, absent = 0, late = 0;
            
            Object.values(attendanceData).forEach(status => {
                if (status === 'present') present++;
                if (status === 'absent') absent++;
                if (status === 'late') late++;
            });
            
            document.getElementById('presentCount').textContent = present;
            document.getElementById('absentCount').textContent = absent;
            document.getElementById('lateCount').textContent = late;
        }

        // Mark all students as present
        function markAllPresent() {
            Object.keys(attendanceData).forEach(studentEmail => {
                setAttendanceStatus(studentEmail, 'present');
            });
        }

        // Mark all students as absent
        function markAllAbsent() {
            Object.keys(attendanceData).forEach(studentEmail => {
                setAttendanceStatus(studentEmail, 'absent');
            });
        }

        async function loadLeaveRequests() {
            try {
                const response = await fetch(`/api/leave-requests/${currentUser.department}`);
                const result = await response.json();
                
                if (result.success) {
                    const leaveRequestsList = document.getElementById('leaveRequestsList');
                    const leaveRequestsSection = document.getElementById('leaveRequestsSection');
                    
                    if (result.leaveRequests.length > 0) {
                        leaveRequestsSection.classList.remove('hidden');
                        leaveRequestsList.innerHTML = '';
                        
                        result.leaveRequests.forEach(request => {
                            const leaveItem = document.createElement('div');
                            leaveItem.className = 'leave-request';
                            leaveItem.innerHTML = `
                                <div class="leave-header">
                                    <h4>${request.userEmail}</h4>
                                    <span class="leave-status status-${request.status}">${request.status}</span>
                                </div>
                                <p><strong>Period:</strong> ${new Date(request.startDate).toLocaleDateString()} to ${new Date(request.endDate).toLocaleDateString()}</p>
                                <p><strong>Reason:</strong> ${request.reason}</p>
                                ${request.document ? `
                                    <div class="file-item">
                                        <div class="file-info">
                                            <span class="file-icon"></span>
                                            <span>Supporting Document</span>
                                        </div>
                                        <button class="btn btn-primary btn-sm" onclick="downloadFile('${request.document.url}', '${request.document.name}')">Download</button>
                                    </div>
                                ` : ''}
                                <div style="margin-top: 10px;">
                                    <button class="btn btn-success btn-sm" onclick="updateLeaveStatus('${request.id}', 'approved')">Approve</button>
                                    <button class="btn btn-danger btn-sm" onclick="updateLeaveStatus('${request.id}', 'rejected')">Reject</button>
                                </div>
                            `;
                            leaveRequestsList.appendChild(leaveItem);
                        });
                    } else {
                        leaveRequestsSection.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('Error loading leave requests:', error);
            }
        }

        async function updateLeaveStatus(leaveId, status) {
            try {
                const response = await fetch('/api/leave-status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ leaveId, status })
                });

                const result = await response.json();
                if (result.success) {
                    alert('Leave request updated successfully');
                    loadLeaveRequests();
                }
            } catch (error) {
                alert('Leave status update failed: ' + error.message);
            }
        }

        async function loadStudentPerformance() {
            const studentEmail = document.getElementById('performanceStudent').value;
            if (!studentEmail) return;

            try {
                // Fetch student data
                const [attendanceRes, gradesRes] = await Promise.all([
                    fetch(`/api/attendance/${studentEmail}`),
                    fetch(`/api/grades/${studentEmail}`)
                ]);

                const attendanceResult = await attendanceRes.json();
                const gradesResult = await gradesRes.json();

                let html = '<div class="performance-chart">';
                
                if (attendanceResult.success) {
                    html += '<h3>Attendance</h3>';
                    // Group by course
                    const courseData = {};
                    attendanceResult.attendance.forEach(record => {
                        if (!courseData[record.course]) {
                            courseData[record.course] = { present: 0, total: 0 };
                        }
                        courseData[record.course].total++;
                        if (record.status === 'present') courseData[record.course].present++;
                    });

                    for (const [course, data] of Object.entries(courseData)) {
                        const percentage = (data.present / data.total) * 100;
                        let percentageClass = 'percentage-high';
                        if (percentage < 75) percentageClass = 'percentage-medium';
                        if (percentage < 50) percentageClass = 'percentage-low';
                        
                        html += `
                            <div style="margin-bottom: 10px;">
                                <strong>${course}:</strong> 
                                <span class="attendance-percentage ${percentageClass}">${percentage.toFixed(1)}%</span>
                                (${data.present}/${data.total})
                                <div class="graph-bar" style="width: ${percentage}%;"></div>
                            </div>
                        `;
                    }
                }

                if (gradesResult.success && gradesResult.grades.length > 0) {
                    html += '<h3 style="margin-top: 20px;">Grades</h3>';
                    gradesResult.grades.forEach(grade => {
                        html += `
                            <div class="feature-card" style="display: inline-block; margin: 5px;">
                                <h4>${grade.course}</h4>
                                <p>Grade: ${grade.grade}</p>
                                <p>Semester: ${grade.semester}</p>
                            </div>
                        `;
                    });
                }

                html += '</div>';
                document.getElementById('performanceContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading student performance:', error);
                document.getElementById('performanceContent').innerHTML = '<p>Error loading performance data</p>';
            }
        }

        function handleCourseFileUpload(input) {
            if (input.files.length > 0) {
                for (let i = 0; i < input.files.length; i++) {
                    courseFiles.push(input.files[i]);
                }
                updateCourseFilesList();
            }
        }

        function updateCourseFilesList() {
            const filesList = document.getElementById('courseFilesList');
            filesList.innerHTML = '';
            
            courseFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <span class="file-icon"></span>
                        <span>${file.name}</span>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="removeCourseFile(${index})">Remove</button>
                `;
                filesList.appendChild(fileItem);
            });
        }

        function removeCourseFile(index) {
            courseFiles.splice(index, 1);
            updateCourseFilesList();
        }

        function handleAssignmentFileUpload(input) {
            if (input.files.length > 0) {
                for (let i = 0; i < input.files.length; i++) {
                    assignmentFiles.push(input.files[i]);
                }
                updateAssignmentFilesList();
            }
        }

        function updateAssignmentFilesList() {
            const filesList = document.getElementById('assignmentFilesList');
            filesList.innerHTML = '';
            
            assignmentFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <span class="file-icon"></span>
                        <span>${file.name}</span>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="removeAssignmentFile(${index})">Remove</button>
                `;
                filesList.appendChild(fileItem);
            });
        }

        function removeAssignmentFile(index) {
            assignmentFiles.splice(index, 1);
            updateAssignmentFilesList();
        }

        function handleEventFileUpload(input) {
            if (input.files.length > 0) {
                for (let i = 0; i < input.files.length; i++) {
                    eventFiles.push(input.files[i]);
                }
                updateEventFilesList();
            }
        }

        function updateEventFilesList() {
            const filesList = document.getElementById('eventFilesList');
            filesList.innerHTML = '';
            
            eventFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <span class="file-icon"></span>
                        <span>${file.name}</span>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="removeEventFile(${index})">Remove</button>
                `;
                filesList.appendChild(fileItem);
            });
        }

        function removeEventFile(index) {
            eventFiles.splice(index, 1);
            updateEventFilesList();
        }

        function handleQuestionPaperFileUpload(input) {
            if (input.files.length > 0) {
                for (let i = 0; i < input.files.length; i++) {
                    questionPaperFiles.push(input.files[i]);
                }
                updateQuestionPaperFilesList();
            }
        }

        function updateQuestionPaperFilesList() {
            const filesList = document.getElementById('questionPaperFilesList');
            filesList.innerHTML = '';
            
            questionPaperFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <span class="file-icon"></span>
                        <span>${file.name}</span>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="removeQuestionPaperFile(${index})">Remove</button>
                `;
                filesList.appendChild(fileItem);
            });
        }

        function removeQuestionPaperFile(index) {
            questionPaperFiles.splice(index, 1);
            updateQuestionPaperFilesList();
        }

        async function createCourse() {
            const formData = new FormData();
            formData.append('teacherEmail', currentUser.email);
            formData.append('courseName', document.getElementById('courseName').value);
            formData.append('description', document.getElementById('courseDescription').value);
            formData.append('duration', document.getElementById('courseDuration').value);
            formData.append('department', currentUser.department);
            
            // Add files
            courseFiles.forEach(file => {
                formData.append('files', file);
            });

            try {
                const response = await fetch('/api/courses', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    document.getElementById('courseName').value = '';
                    document.getElementById('courseDescription').value = '';
                    document.getElementById('courseDuration').value = '';
                    courseFiles = [];
                    updateCourseFilesList();
                    loadTeacherCourses();
                    loadTeacherStats();
                }
            } catch (error) {
                alert('Course creation failed: ' + error.message);
            }
        }

        async function loadTeacherCourses() {
            try {
                const response = await fetch(`/api/courses/${currentUser.department}`);
                const result = await response.json();
                
                let html = '<div class="grid">';
                if (result.success && result.courses.length > 0) {
                    const teacherCourses = result.courses.filter(course => course.teacherEmail === currentUser.email);
                    
                    if (teacherCourses.length > 0) {
                        teacherCourses.forEach(course => {
                            // Get enrolled students count
                            const enrolledStudents = enrollments.filter(enrollment => enrollment.courseId === course.id).length;
                            
                            html += `
                                <div class="course-card">
                                    <h3>${course.courseName}</h3>
                                    <p><strong>Duration:</strong> ${course.duration}</p>
                                    <p>${course.description}</p>
                                    <p><strong>Enrolled Students:</strong> ${enrolledStudents}</p>
                                    <button class="btn btn-primary" onclick="viewCourseStudents('${course.id}')">View Students</button>
                                </div>
                            `;
                        });
                    } else {
                        html += '<p>You haven\'t created any courses yet.</p>';
                    }
                } else {
                    html += '<p>No courses found.</p>';
                }
                html += '</div>';
                document.getElementById('teacherCoursesContent').innerHTML = html;

                // Also populate course dropdowns
                const courseSelects = document.querySelectorAll('select[id*="Course"]');
                courseSelects.forEach(select => {
                    select.innerHTML = '<option value="">Select course</option>';
                    if (result.success && result.courses.length > 0) {
                        result.courses.forEach(course => {
                            if (course.teacherEmail === currentUser.email) {
                                const option = document.createElement('option');
                                option.value = course.courseName;
                                option.textContent = course.courseName;
                                select.appendChild(option);
                            }
                        });
                    }
                });
            } catch (error) {
                console.error('Error loading teacher courses:', error);
                document.getElementById('teacherCoursesContent').innerHTML = '<p>Error loading courses</p>';
            }
        }

        async function viewCourseStudents(courseId) {
            try {
                const response = await fetch(`/api/course-students/${courseId}`);
                const result = await response.json();
                
                if (result.success) {
                    let studentsHtml = '<h3>Enrolled Students:</h3><ul>';
                    result.students.forEach(student => {
                        studentsHtml += `<li>${student.name} (${student.rollNumber}) - ${student.email} - Enrolled: ${new Date(student.enrolledDate).toLocaleDateString()}</li>`;
                    });
                    studentsHtml += '</ul>';
                    alert(studentsHtml);
                }
            } catch (error) {
                alert('Error viewing course students: ' + error.message);
            }
        }

        async function loadTeacherAssignments() {
            try {
                const response = await fetch(`/api/assignments/${currentUser.department}`);
                const result = await response.json();
                
                const assignmentSelect = document.getElementById('submissionAssignment');
                assignmentSelect.innerHTML = '<option value="">Select assignment</option>';
                
                if (result.success && result.assignments.length > 0) {
                    const teacherAssignments = result.assignments.filter(assignment => assignment.teacherEmail === currentUser.email);
                    
                    teacherAssignments.forEach(assignment => {
                        const option = document.createElement('option');
                        option.value = assignment.id;
                        option.textContent = assignment.title;
                        assignmentSelect.appendChild(option);
                    });

                    // Also populate grade assignment dropdown
                    const gradeAssignmentSelect = document.getElementById('gradeAssignment');
                    gradeAssignmentSelect.innerHTML = '<option value="">Select assignment</option>';
                    teacherAssignments.forEach(assignment => {
                        const option = document.createElement('option');
                        option.value = assignment.id;
                        option.textContent = assignment.title;
                        gradeAssignmentSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading teacher assignments:', error);
            }
        }

        async function loadAssignmentSubmissions() {
            const assignmentId = document.getElementById('submissionAssignment').value;
            if (!assignmentId) return;

            try {
                const response = await fetch(`/api/assignment-submissions/${assignmentId}`);
                const result = await response.json();
                
                let html = '';
                if (result.success && result.submissions.length > 0) {
                    html = '<h3>Submissions:</h3>';
                    result.submissions.forEach(submission => {
                        html += `
                            <div class="file-item">
                                <div class="file-info">
                                    <span class="file-icon"></span>
                                    <span>${submission.studentEmail}</span>
                                    <span style="margin-left: 10px; color: #666;">Submitted: ${new Date(submission.submittedDate).toLocaleString()}</span>
                                </div>
                                <div>
                                    ${submission.file ? 
                                        `<button class="btn btn-primary btn-sm" onclick="downloadFile('${submission.file.url}', '${file.name}')">Download</button>` :
                                        '<span>No file submitted</span>'
                                    }
                                    <button class="btn btn-success btn-sm" onclick="gradeSubmission('${submission.studentEmail}', '${assignmentId}')">Grade</button>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html = '<p>No submissions for this assignment yet.</p>';
                }
                document.getElementById('submissionsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading assignment submissions:', error);
                document.getElementById('submissionsContent').innerHTML = '<p>Error loading submissions</p>';
            }
        }

        function gradeSubmission(studentEmail, assignmentId) {
            const grade = prompt(`Enter grade for ${studentEmail}:`);
            if (grade) {
                // Find the assignment to get course name
                const assignment = assignments.find(a => a.id === assignmentId);
                if (assignment) {
                    uploadGradeForStudent(studentEmail, assignment.course, assignmentId, grade);
                }
            }
        }

        async function uploadGradeForStudent(studentEmail, course, assignmentId, grade) {
            const gradeData = {
                teacherEmail: currentUser.email,
                studentEmail: studentEmail,
                course: course,
                grade: grade,
                semester: '2024-1',
                assignmentId: assignmentId
            };

            try {
                const response = await fetch('/api/grades', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(gradeData)
                });

                const result = await response.json();
                alert(result.message);
            } catch (error) {
                alert('Grade upload failed: ' + error.message);
            }
        }

        // Enhanced Attendance Recording
        async function recordAttendance() {
            const courseId = document.getElementById('attendanceCourse').value;
            const date = document.getElementById('attendanceDate').value;
            const courseName = document.getElementById('attendanceCourse').options[document.getElementById('attendanceCourse').selectedIndex].text;
            
            if (!courseId || !date) {
                alert('Please select a course and date');
                return;
            }

            if (Object.keys(attendanceData).length === 0) {
                alert('No students to record attendance for');
                return;
            }

            try {
                let successCount = 0;
                let errorCount = 0;
                
                for (const [studentEmail, status] of Object.entries(attendanceData)) {
                    const attendanceRecord = {
                        teacherEmail: currentUser.email,
                        studentEmail: studentEmail,
                        course: courseName,
                        date: date,
                        status: status
                    };

                    const response = await fetch('/api/attendance', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(attendanceRecord)
                    });

                    const result = await response.json();
                    if (result.success) {
                        successCount++;
                        
                        // Send notification to student
                        sendNotification(
                            studentEmail,
                            'Attendance Recorded',
                            `Your attendance for ${courseName} on ${date} has been marked as ${status}.`,
                            'info'
                        );
                    } else {
                        errorCount++;
                    }
                }
                
                alert(`Attendance recorded for ${successCount} students. ${errorCount > 0 ? `${errorCount} errors occurred.` : ''}`);
                
                // Reset attendance data
                attendanceData = {};
                
            } catch (error) {
                alert('Attendance recording failed: ' + error.message);
            }
        }

        async function uploadGrade() {
            const gradeData = {
                teacherEmail: currentUser.email,
                studentEmail: document.getElementById('gradeStudent').value,
                course: document.getElementById('gradeCourse').value,
                grade: document.getElementById('studentGrade').value,
                semester: document.getElementById('gradeSemester').value,
                assignmentId: document.getElementById('gradeAssignment').value
            };

            try {
                const response = await fetch('/api/grades', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(gradeData)
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    document.getElementById('gradeStudent').value = '';
                    document.getElementById('gradeCourse').value = '';
                    document.getElementById('studentGrade').value = '';
                    document.getElementById('gradeSemester').value = '';
                    document.getElementById('gradeAssignment').value = '';
                }
            } catch (error) {
                alert('Grade upload failed: ' + error.message);
            }
        }

        async function uploadAssignment() {
            const formData = new FormData();
            formData.append('teacherEmail', currentUser.email);
            formData.append('title', document.getElementById('assignmentTitle').value);
            formData.append('description', document.getElementById('assignmentDescription').value);
            formData.append('dueDate', document.getElementById('assignmentDueDate').value);
            formData.append('course', document.getElementById('assignmentCourse').value);
            formData.append('department', currentUser.department);
            
            // Add files
            assignmentFiles.forEach(file => {
                formData.append('files', file);
            });

            try {
                const response = await fetch('/api/assignments', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    document.getElementById('assignmentTitle').value = '';
                    document.getElementById('assignmentDescription').value = '';
                    document.getElementById('assignmentDueDate').value = '';
                    document.getElementById('assignmentCourse').value = '';
                    assignmentFiles = [];
                    updateAssignmentFilesList();
                    loadTeacherAssignments();
                    loadTeacherStats();
                }
            } catch (error) {
                alert('Assignment upload failed: ' + error.message);
            }
        }

        async function uploadTimetable() {
            const fileInput = document.getElementById('timetableFile');
            if (!fileInput.files[0]) {
                alert('Please select a timetable image');
                return;
            }

            const formData = new FormData();
            formData.append('teacherEmail', currentUser.email);
            formData.append('department', document.getElementById('timetableDepartment').value);
            formData.append('description', document.getElementById('timetableDescription').value);
            formData.append('timetableImage', fileInput.files[0]);

            try {
                const response = await fetch('/api/timetable', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    document.getElementById('timetableDescription').value = '';
                    document.getElementById('timetableFile').value = '';
                    document.getElementById('timetablePreview').classList.add('hidden');
                    }
            } catch (error) {
                alert('Timetable upload failed: ' + error.message);
            }
        }

        // Live Sessions Management
        async function createLiveSession() {
            const liveSessionData = {
                teacherEmail: currentUser.email,
                title: document.getElementById('liveSessionTitle').value,
                description: document.getElementById('liveSessionDescription').value,
                dateTime: document.getElementById('liveSessionDateTime').value,
                duration: document.getElementById('liveSessionDuration').value,
                course: document.getElementById('liveSessionCourse').value,
                link: document.getElementById('liveSessionLink').value
            };

            try {
                const response = await fetch('/api/live-sessions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(liveSessionData)
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    document.getElementById('liveSessionTitle').value = '';
                    document.getElementById('liveSessionDescription').value = '';
                    document.getElementById('liveSessionDateTime').value = '';
                    document.getElementById('liveSessionDuration').value = '';
                    document.getElementById('liveSessionCourse').value = '';
                    document.getElementById('liveSessionLink').value = '';
                    loadTeacherLiveSessions();
                    
                    // Notify enrolled students
                    const courseObj = courses.find(c => c.courseName === liveSessionData.course);
                    if (courseObj) {
                        const courseEnrollments = enrollments.filter(enrollment => enrollment.courseId === courseObj.id);
                        courseEnrollments.forEach(enrollment => {
                            sendNotification(
                                enrollment.studentEmail,
                                'New Live Session',
                                `A new live session "${liveSessionData.title}" has been scheduled for ${liveSessionData.course}.`,
                                'info'
                            );
                        });
                    }
                }
            } catch (error) {
                alert('Live session creation failed: ' + error.message);
            }
        }

        async function loadTeacherLiveSessions() {
            try {
                const response = await fetch('/api/live-sessions');
                const result = await response.json();
                
                let html = '';
                if (result.success && result.liveSessions.length > 0) {
                    const teacherSessions = result.liveSessions.filter(session => session.teacherEmail === currentUser.email);
                    
                    if (teacherSessions.length > 0) {
                        teacherSessions.forEach(session => {
                            const sessionDate = new Date(session.dateTime);
                            const now = new Date();
                            const isUpcoming = sessionDate > now;
                            
                            html += `
                                <div class="live-session-card">
                                    <div class="live-session-header">
                                        <h3 class="live-session-title">${session.title}</h3>
                                        <div class="live-session-time">${sessionDate.toLocaleString()}</div>
                                    </div>
                                    <div class="live-session-description">
                                        <p>${session.description}</p>
                                        <p><strong>Course:</strong> ${session.course}</p>
                                        <p><strong>Duration:</strong> ${session.duration} minutes</p>
                                        <p><strong>Status:</strong> ${isUpcoming ? 'Upcoming' : 'Completed'}</p>
                                    </div>
                                    <div class="live-session-actions">
                                        <a href="${session.link}" target="_blank" class="btn btn-primary">
                                            <i class="fas fa-video"></i> ${isUpcoming ? 'Start Session' : 'View Recording'}
                                        </a>
                                        <button class="btn btn-danger btn-sm" onclick="deleteLiveSession('${session.id}')">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        html = '<p>You haven\'t scheduled any live sessions yet.</p>';
                    }
                } else {
                    html = '<p>No live sessions found.</p>';
                }
                document.getElementById('scheduledLiveSessionsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading teacher live sessions:', error);
                document.getElementById('scheduledLiveSessionsContent').innerHTML = '<p>Error loading live sessions</p>';
            }
        }

        async function deleteLiveSession(sessionId) {
            if (confirm('Are you sure you want to delete this live session?')) {
                try {
                    const response = await fetch(`/api/live-sessions/${sessionId}`, {
                        method: 'DELETE'
                    });

                    const result = await response.json();
                    alert(result.message);
                    if (result.success) {
                        loadTeacherLiveSessions();
                    }
                } catch (error) {
                    alert('Live session deletion failed: ' + error.message);
                }
            }
        }

        async function createEvent() {
            const formData = new FormData();
            formData.append('teacherEmail', currentUser.email);
            formData.append('title', document.getElementById('eventTitle').value);
            formData.append('description', document.getElementById('eventDescription').value);
            formData.append('date', document.getElementById('eventDate').value);
            formData.append('type', document.getElementById('eventType').value);
            formData.append('registrationLink', document.getElementById('eventRegistrationLink').value);
            
            // Add files
            eventFiles.forEach(file => {
                formData.append('files', file);
            });

            try {
                const response = await fetch('/api/events', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    document.getElementById('eventTitle').value = '';
                    document.getElementById('eventDescription').value = '';
                    document.getElementById('eventDate').value = '';
                    document.getElementById('eventRegistrationLink').value = '';
                    eventFiles = [];
                    updateEventFilesList();
                    loadExistingEvents();
                    
                    // Notify students
                    const studentsResponse = await fetch(`/api/students/${currentUser.department}`);
                    const studentsResult = await studentsResponse.json();
                    if (studentsResult.success) {
                        studentsResult.students.forEach(student => {
                            sendNotification(
                                student.email,
                                'New Event',
                                `A new event "${document.getElementById('eventTitle').value}" has been announced.`,
                                'info'
                            );
                        });
                    }
                }
            } catch (error) {
                alert('Event creation failed: ' + error.message);
            }
        }

        async function loadTeacherEvents() {
            try {
                const response = await fetch('/api/events');
                const result = await response.json();
                
                if (result.success) {
                    const teacherEvents = result.events.filter(event => event.teacherEmail === currentUser.email);
                    // This will be used in loadExistingEvents
                    window.teacherEvents = teacherEvents;
                }
            } catch (error) {
                console.error('Error loading teacher events:', error);
            }
        }

        async function loadExistingEvents() {
            try {
                const response = await fetch('/api/events');
                const result = await response.json();
                
                let html = '<div class="events-container">';
                if (result.success && result.events.length > 0) {
                    const teacherEvents = result.events.filter(event => event.teacherEmail === currentUser.email);
                    
                    if (teacherEvents.length > 0) {
                        teacherEvents.forEach(event => {
                            html += `
                                <div class="event-card">
                                    <div class="event-header">
                                        <h3 class="event-title">${event.title}</h3>
                                        <div class="event-date">${new Date(event.date).toLocaleDateString()}</div>
                                    </div>
                                    <div class="event-description">
                                        <p>${event.description}</p>
                                        <p><strong>Type:</strong> ${event.type}</p>
                                    </div>
                                    ${event.files && event.files.length > 0 ? `
                                        <div class="file-list">
                                            <h4>Event Materials:</h4>
                                            ${event.files.map(file => `
                                                <div class="file-item">
                                                    <div class="file-info">
                                                        <span class="file-icon"></span>
                                                        <span>${file.name}</span>
                                                    </div>
                                                    <button class="btn btn-primary btn-sm" onclick="downloadFile('${file.url}', '${file.name}')">Download</button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                    ${event.registrationLink ? `
                                        <div class="event-actions">
                                            <a href="${event.registrationLink}" target="_blank" class="btn btn-primary">
                                                <i class="fas fa-external-link-alt"></i> Registration Link
                                            </a>
                                        </div>
                                    ` : ''}
                                    <div class="event-actions">
                                        <button class="btn btn-danger btn-sm" onclick="deleteEvent('${event.id}')">
                                            <i class="fas fa-trash"></i> Delete Event
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        html += '<p>You haven\'t created any events yet.</p>';
                    }
                } else {
                    html += '<p>No events found.</p>';
                }
                html += '</div>';
                document.getElementById('existingEventsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading existing events:', error);
                document.getElementById('existingEventsContent').innerHTML = '<p>Error loading events</p>';
            }
        }

        async function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                try {
                    const response = await fetch(`/api/events/${eventId}`, {
                        method: 'DELETE'
                    });

                    const result = await response.json();
                    alert(result.message);
                    if (result.success) {
                        loadExistingEvents();
                    }
                } catch (error) {
                    alert('Event deletion failed: ' + error.message);
                }
            }
        }

        // Question Papers Management
        async function uploadQuestionPaper() {
            const formData = new FormData();
            formData.append('teacherEmail', currentUser.email);
            formData.append('title', document.getElementById('questionPaperTitle').value);
            formData.append('description', document.getElementById('questionPaperDescription').value);
            formData.append('course', document.getElementById('questionPaperCourse').value);
            formData.append('year', document.getElementById('questionPaperYear').value);
            
            // Add files
            questionPaperFiles.forEach(file => {
                formData.append('files', file);
            });

            try {
                const response = await fetch('/api/question-papers', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    document.getElementById('questionPaperTitle').value = '';
                    document.getElementById('questionPaperDescription').value = '';
                    document.getElementById('questionPaperCourse').value = '';
                    document.getElementById('questionPaperYear').value = '';
                    questionPaperFiles = [];
                    updateQuestionPaperFilesList();
                    loadTeacherQuestionPapers();
                    
                    // Notify students
                    const studentsResponse = await fetch(`/api/students/${currentUser.department}`);
                    const studentsResult = await studentsResponse.json();
                    if (studentsResult.success) {
                        studentsResult.students.forEach(student => {
                            sendNotification(
                                student.email,
                                'New Question Paper',
                                `A new question paper has been uploaded for ${document.getElementById('questionPaperCourse').value}.`,
                                'info'
                            );
                        });
                    }
                }
            } catch (error) {
                alert('Question paper upload failed: ' + error.message);
            }
        }

        async function loadTeacherQuestionPapers() {
            try {
                const response = await fetch('/api/question-papers');
                const result = await response.json();
                
                let html = '<div class="grid">';
                if (result.success && result.questionPapers.length > 0) {
                    const teacherQuestionPapers = result.questionPapers.filter(paper => paper.teacherEmail === currentUser.email);
                    
                    if (teacherQuestionPapers.length > 0) {
                        teacherQuestionPapers.forEach(paper => {
                            html += `
                                <div class="question-paper-card">
                                    <div class="question-paper-header">
                                        <h3 class="question-paper-title">${paper.title}</h3>
                                        <div class="question-paper-year">${paper.year}</div>
                                    </div>
                                    <div class="question-paper-description">
                                        <p>${paper.description}</p>
                                        <p><strong>Course:</strong> ${paper.course}</p>
                                    </div>
                                    <div class="question-paper-actions">
                                        <button class="btn btn-primary" onclick="downloadFile('${paper.file.url}', '${paper.file.name}')">
                                            <i class="fas fa-download"></i> Download
                                        </button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteQuestionPaper('${paper.id}')">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        html += '<p>You haven\'t uploaded any question papers yet.</p>';
                    }
                } else {
                    html += '<p>No question papers found.</p>';
                }
                html += '</div>';
                document.getElementById('uploadedQuestionPapersContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading teacher question papers:', error);
                document.getElementById('uploadedQuestionPapersContent').innerHTML = '<p>Error loading question papers</p>';
            }
        }

        async function deleteQuestionPaper(paperId) {
            if (confirm('Are you sure you want to delete this question paper?')) {
                try {
                    const response = await fetch(`/api/question-papers/${paperId}`, {
                        method: 'DELETE'
                    });

                    const result = await response.json();
                    alert(result.message);
                    if (result.success) {
                        loadTeacherQuestionPapers();
                    }
                } catch (error) {
                    alert('Question paper deletion failed: ' + error.message);
                }
            }
        }

        async function loadTeacherHolidayCalendar() {
            try {
                // Generate a sample holiday calendar for the current month
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                
                // Indian holidays (sample data)
                const holidays = [
                    { day: 1, name: 'New Year' },
                    { day: 26, name: 'Republic Day' },
                    { day: 15, name: 'Holi' },
                    { day: 25, name: 'Good Friday' },
                    { day: 1, name: 'May Day' },
                    { day: 15, name: 'Independence Day' },
                    { day: 2, name: 'Gandhi Jayanti' },
                    { day: 25, name: 'Christmas' }
                ];
                
                let html = '<div class="holiday-calendar">';
                
                // Calendar header
                const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                html += '<div class="holiday-header">';
                weekdays.forEach(day => {
                    html += `<div>${day}</div>`;
                });
                html += '</div>';
                
                // Calendar days
                let dayCount = 1;
                for (let i = 0; i < 6; i++) {
                    for (let j = 0; j < 7; j++) {
                        if ((i === 0 && j < firstDay.getDay()) || dayCount > daysInMonth) {
                            html += '<div class="holiday-day"></div>';
                        } else {
                            const isToday = dayCount === now.getDate() && month === now.getMonth() && year === now.getFullYear();
                            const holiday = holidays.find(h => h.day === dayCount);
                            
                            html += `
                                <div class="holiday-day ${isToday ? 'today' : ''} ${holiday ? 'holiday' : ''}">
                                    ${dayCount}
                                    ${holiday ? `<br><small>${holiday.name}</small>` : ''}
                                </div>
                            `;
                            dayCount++;
                        }
                    }
                }
                
                html += '</div>';
                document.getElementById('holidayCalendarContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading holiday calendar:', error);
                document.getElementById('holidayCalendarContent').innerHTML = '<p>Error loading holiday calendar</p>';
            }
        }

        // Leaderboard Management
        async function loadLeaderboard() {
            try {
                const month = document.getElementById('leaderboardMonth').value;
                const year = document.getElementById('leaderboardYear').value;
                
                const response = await fetch(`/api/leaderboard/${year}/${month}`);
                const result = await response.json();
                
                let html = '';
                if (result.success) {
                    if (result.leaderboard.length > 0) {
                        html = '<h3>Current Leaderboard</h3>';
                        result.leaderboard.forEach((student, index) => {
                            const rank = index + 1;
                            html += `
                                <div class="leaderboard-item">
                                    <div class="leaderboard-rank ${rank <= 3 ? `leaderboard-rank-${rank}` : ''}">
                                        ${rank}
                                    </div>
                                    <div class="leaderboard-student-info">
                                        <div class="leaderboard-student-name">${student.name}</div>
                                        <div class="leaderboard-student-email">${student.email}</div>
                                    </div>
                                    <div class="leaderboard-student-credits">
                                        ${student.credits} Credits
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                            <div style="margin-top: 30px;">
                                <h3>Update Leaderboard</h3>
                                <div class="form-group">
                                    <label>Select Top 3 Students</label>
                                    <select id="firstPlace">
                                        <option value="">First Place</option>
                                    </select>
                                    <select id="secondPlace">
                                        <option value="">Second Place</option>
                                    </select>
                                    <select id="thirdPlace">
                                        <option value="">Third Place</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary" onclick="updateLeaderboard()">Update Leaderboard</button>
                            </div>
                        `;
                        
                        // Populate student dropdowns
                        const studentsResponse = await fetch(`/api/students/${currentUser.department}`);
                        const studentsResult = await studentsResponse.json();
                        
                        if (studentsResult.success) {
                            const firstPlace = document.getElementById('firstPlace');
                            const secondPlace = document.getElementById('secondPlace');
                            const thirdPlace = document.getElementById('thirdPlace');
                            
                            studentsResult.students.forEach(student => {
                                const option1 = document.createElement('option');
                                option1.value = student.email;
                                option1.textContent = `${student.name} (${student.rollNumber})`;
                                firstPlace.appendChild(option1);
                                
                                const option2 = document.createElement('option');
                                option2.value = student.email;
                                option2.textContent = `${student.name} (${student.rollNumber})`;
                                secondPlace.appendChild(option2);
                                
                                const option3 = document.createElement('option');
                                option3.value = student.email;
                                option3.textContent = `${student.name} (${student.rollNumber})`;
                                thirdPlace.appendChild(option3);
                            });
                        }
                    } else {
                        html = '<p>No leaderboard data for this month. Create a new leaderboard.</p>';
                    }
                } else {
                    html = '<p>Error loading leaderboard data.</p>';
                }
                document.getElementById('leaderboardManagementContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                document.getElementById('leaderboardManagementContent').innerHTML = '<p>Error loading leaderboard</p>';
            }
        }

        async function updateLeaderboard() {
            const firstPlace = document.getElementById('firstPlace').value;
            const secondPlace = document.getElementById('secondPlace').value;
            const thirdPlace = document.getElementById('thirdPlace').value;
            const month = document.getElementById('leaderboardMonth').value;
            const year = document.getElementById('leaderboardYear').value;
            
            if (!firstPlace || !secondPlace || !thirdPlace) {
                alert('Please select all three top students');
                return;
            }

            try {
                const response = await fetch('/api/leaderboard', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        year: year,
                        month: month,
                        firstPlace: firstPlace,
                        secondPlace: secondPlace,
                        thirdPlace: thirdPlace
                    })
                });

                const result = await response.json();
                alert(result.message);
                if (result.success) {
                    loadLeaderboard();
                }
            } catch (error) {
                alert('Leaderboard update failed: ' + error.message);
            }
        }

        async function loadTeacherForum() {
            try {
                const response = await fetch(`/api/courses/${currentUser.department}`);
                const result = await response.json();
                
                const courseSelect = document.getElementById('teacherForumCourseSelect');
                courseSelect.innerHTML = '<option value="">Select a course</option>';
                
                if (result.success && result.courses.length > 0) {
                    const teacherCourses = result.courses.filter(course => course.teacherEmail === currentUser.email);
                    teacherCourses.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course.id;
                        option.textContent = course.courseName;
                        courseSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading teacher forum courses:', error);
            }
        }

        async function loadTeacherForumPosts() {
            const courseId = document.getElementById('teacherForumCourseSelect').value;
            if (!courseId) return;

            try {
                const response = await fetch(`/api/forum-posts/${courseId}`);
                const result = await response.json();
                
                let html = '';
                if (result.success && result.posts.length > 0) {
                    result.posts.forEach(post => {
                        html += `
                            <div class="forum-post">
                                <h4>${post.title}</h4>
                                <p><strong>By:</strong> ${post.userEmail}</p>
                                <p>${post.content}</p>
                                <p><small>Posted: ${new Date(post.createdDate).toLocaleString()}</small></p>
                                
                                <div class="forum-replies">
                                    <h5>Replies (${post.replies.length}):</h5>
                                    ${post.replies.map(reply => `
                                        <div class="forum-reply">
                                            <p><strong>${reply.userEmail}:</strong> ${reply.content}</p>
                                            <p><small>${new Date(reply.createdDate).toLocaleString()}</small></p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html = '<p>No discussions in this course yet.</p>';
                }
                
                document.getElementById('teacherForumContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading teacher forum posts:', error);
                document.getElementById('teacherForumContent').innerHTML = '<p>Error loading forum posts</p>';
            }
        }

        async function loadTeacherNotifications() {
            try {
                const response = await fetch(`/api/notifications/${currentUser.email}`);
                const result = await response.json();
                
                let html = '';
                if (result.success && result.notifications.length > 0) {
                    result.notifications.forEach(notification => {
                        html += `
                            <div class="notification-item ${notification.read ? '' : 'unread'}" onclick="markTeacherNotificationAsRead('${notification.id}')">
                                <h4>${notification.title}</h4>
                                <p>${notification.message}</p>
                                <p><small>${new Date(notification.timestamp).toLocaleString()}</small></p>
                            </div>
                        `;
                    });
                } else {
                    html = '<p>No notifications.</p>';
                }
                document.getElementById('teacherNotificationsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading teacher notifications:', error);
                document.getElementById('teacherNotificationsContent').innerHTML = '<p>Error loading notifications</p>';
            }
        }

        async function markTeacherNotificationAsRead(notificationId) {
            try {
                const response = await fetch('/api/notifications/mark-read', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ notificationId })
                });

                const result = await response.json();
                if (result.success) {
                    updateNotificationBadge();
                    loadTeacherNotifications();
                }
            } catch (error) {
                console.error('Error marking teacher notification as read:', error);
            }
        }

        // Parent functions
        function loadParentProfile() {
            document.getElementById('parentName').textContent = currentUser.name;
            const profilePic = document.getElementById('parentProfilePic');
            const profilePicLarge = document.getElementById('parentProfilePicLarge');
            
            if (currentUser.photo) {
                profilePic.style.backgroundImage = `url(${currentUser.photo})`;
                profilePic.textContent = '';
                profilePicLarge.style.backgroundImage = `url(${currentUser.photo})`;
                profilePicLarge.textContent = '';
            } else {
                profilePic.textContent = currentUser.name.charAt(0);
                profilePicLarge.textContent = currentUser.name.charAt(0);
            }
            
            document.getElementById('parentProfileName').textContent = currentUser.name;
            document.getElementById('parentProfileEmail').textContent = currentUser.email;
        }

        function showParentSection(section) {
            document.querySelectorAll('.parent-section').forEach(sec => sec.classList.add('hidden'));
            document.getElementById('parent' + section.charAt(0).toUpperCase() + section.slice(1)).classList.remove('hidden');
            
            document.querySelectorAll('.sidebar-menu li').forEach(li => li.classList.remove('active'));
            event.currentTarget.classList.add('active');

            if (section === 'studentInfo') loadStudentInfo();
            if (section === 'attendance') loadParentAttendance();
            if (section === 'results') loadParentResults();
            if (section === 'timetable') loadParentTimetable();
            if (section === 'performance') loadParentPerformance();
            if (section === 'leaderboard') loadParentLeaderboard();
            if (section === 'notifications') loadParentNotifications();
        }

        async function loadStudentInfo() {
            try {
                const studentEmail = currentUser.studentEmail;
                const response = await fetch(`/api/profile/${studentEmail}`);
                const result = await response.json();
                
                let html = '';
                if (result.success) {
                    const student = result.user;
                    html = `
                        <div class="profile-header">
                            <h3>Student Information</h3>
                            <div class="profile-pic">${student.name.charAt(0)}</div>
                            <h3>${student.name}</h3>
                            <p>Email: ${student.email}</p>
                            <p>Roll Number: ${student.rollNumber}</p>
                            <p>Department: ${student.department.replace('_', ' ').toUpperCase()}</p>
                            <p>Father's Name: ${student.fatherName}</p>
                        </div>
                    `;
                } else {
                    html = '<p>Unable to load student information.</p>';
                }
                document.getElementById('studentInfoContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading student info:', error);
                document.getElementById('studentInfoContent').innerHTML = '<p>Error loading student information</p>';
            }
        }

        async function loadParentAttendance() {
            try {
                const studentEmail = currentUser.studentEmail;
                const response = await fetch(`/api/attendance/${studentEmail}`);
                const result = await response.json();
                
                let html = '<h3>Student Attendance</h3>';
                if (result.success && result.attendance.length > 0) {
                    // Group by course
                    const courseData = {};
                    result.attendance.forEach(record => {
                        if (!courseData[record.course]) {
                            courseData[record.course] = { present: 0, total: 0 };
                        }
                        courseData[record.course].total++;
                        if (record.status === 'present') courseData[record.course].present++;
                    });

                    html += '<div class="attendance-graph">';
                    for (const [course, data] of Object.entries(courseData)) {
                        const percentage = (data.present / data.total) * 100;
                        let percentageClass = 'percentage-high';
                        if (percentage < 75) percentageClass = 'percentage-medium';
                        if (percentage < 50) percentageClass = 'percentage-low';
                        
                        html += `
                            <div style="margin-bottom: 15px;">
                                <h4>${course}</h4>
                                <p>Attendance: <span class="attendance-percentage ${percentageClass}">${percentage.toFixed(1)}%</span> (${data.present}/${data.total})</p>
                                <div class="graph-bar" style="width: ${percentage}%;"></div>
                            </div>
                        `;
                    }
                    html += '</div>';
                } else {
                    html += '<p>No attendance records available.</p>';
                }
                document.getElementById('parentAttendanceContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading parent attendance:', error);
                document.getElementById('parentAttendanceContent').innerHTML = '<p>Error loading attendance</p>';
            }
        }

        async function loadParentResults() {
            try {
                const studentEmail = currentUser.studentEmail;
                const [gradesResponse, overallResponse] = await Promise.all([
                    fetch(`/api/grades/${studentEmail}`),
                    fetch(`/api/overall-grades/${studentEmail}`)
                ]);
                
                const gradesResult = await gradesResponse.json();
                const overallResult = await overallResponse.json();
                
                let html = '';
                if (gradesResult.success && gradesResult.grades.length > 0) {
                    // Calculate overall GPA and stats
                    let totalPoints = 0;
                    let totalSubjects = gradesResult.grades.length;
                    let passedSubjects = 0;
                    
                    const gradePoints = {
                        'A': 4.0, 'A-': 3.7, 'B+': 3.3, 'B': 3.0, 'B-': 2.7,
                        'C+': 2.3, 'C': 2.0, 'C-': 1.7, 'D+': 1.3, 'D': 1.0, 'F': 0.0
                    };
                    
                    gradesResult.grades.forEach(grade => {
                        const points = gradePoints[grade.grade] || 0;
                        totalPoints += points;
                        if (grade.grade !== 'F') passedSubjects++;
                    });
                    
                    const overallGPA = totalPoints / totalSubjects;
                    
                    // Update summary cards
                    document.getElementById('parentOverallGPA').textContent = overallGPA.toFixed(2);
                    document.getElementById('parentTotalSubjects').textContent = totalSubjects;
                    document.getElementById('parentPassedSubjects').textContent = passedSubjects;
                    document.getElementById('parentSemesterRank').textContent = totalSubjects > 0 ? Math.ceil(Math.random() * 50) + 1 : '-';
                    
                    // Create detailed results table
                    html = `
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Course</th>
                                    <th>Grade</th>
                                    <th>Semester</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    gradesResult.grades.forEach(grade => {
                        const status = grade.grade === 'F' ? 'Failed' : 'Passed';
                        const gradeClass = `grade-${grade.grade}`;
                        html += `
                            <tr>
                                <td>${grade.course}</td>
                                <td class="${gradeClass}">${grade.grade}</td>
                                <td>${grade.semester}</td>
                                <td>${status}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                            </tbody>
                        </table>
                    `;
                } else {
                    html = '<p>No grades available yet.</p>';
                }
                
                document.getElementById('parentResultsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading parent results:', error);
                document.getElementById('parentResultsContent').innerHTML = '<p>Error loading results</p>';
            }
        }

        async function loadParentTimetable() {
            try {
                // Get student's department
                const studentEmail = currentUser.studentEmail;
                const response = await fetch(`/api/profile/${studentEmail}`);
                const result = await response.json();
                
                let html = '';
                if (result.success) {
                    const student = result.user;
                    const timetableResponse = await fetch(`/api/timetable/${student.department}`);
                    const timetableResult = await timetableResponse.json();
                    
                    if (timetableResult.success && timetableResult.timetable) {
                        html = `
                            <h3>${timetableResult.timetable.description}</h3>
                            <p><strong>Uploaded by:</strong> ${timetableResult.timetable.teacherEmail}</p>
                            <p><strong>Date:</strong> ${new Date(timetableResult.timetable.uploadedDate).toLocaleDateString()}</p>
                            ${timetableResult.timetable.image ? `<img src="${timetableResult.timetable.image}" alt="Timetable" class="timetable-image">` : '<p>No timetable image available.</p>'}
                        `;
                    } else {
                        html = '<p>No timetable available for your child\'s department.</p>';
                    }
                } else {
                    html = '<p>Unable to load timetable information.</p>';
                }
                document.getElementById('parentTimetableContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading parent timetable:', error);
                document.getElementById('parentTimetableContent').innerHTML = '<p>Error loading timetable</p>';
            }
        }

        async function loadParentPerformance() {
            try {
                const studentEmail = currentUser.studentEmail;
                const response = await fetch(`/api/performance/${studentEmail}`);
                const result = await response.json();
                
                if (result.success) {
                    let html = '';
                    
                    // Attendance Summary
                    if (result.attendance) {
                        html += '<div class="performance-card"><h3>Attendance Summary</h3>';
                        Object.keys(result.attendance).forEach(course => {
                            const data = result.attendance[course];
                            html += `
                                <div style="margin-bottom: 15px;">
                                    <h4>${course}</h4>
                                    <p>Attendance: ${data.percentage.toFixed(1)}% (${data.present}/${data.total})</p>
                                    <div class="graph-bar" style="width: ${data.percentage}%;"></div>
                                </div>
                            `;
                        });
                        html += '</div>';
                    }
                    
                    // Grade Distribution
                    if (result.grades && result.grades.length > 0) {
                        const gradeCount = {};
                        result.grades.forEach(grade => {
                            gradeCount[grade.grade] = (gradeCount[grade.grade] || 0) + 1;
                        });
                        
                        html += '<div class="performance-card"><h3>Grade Distribution</h3>';
                        Object.keys(gradeCount).forEach(grade => {
                            const count = gradeCount[grade];
                            html += `<p>${grade}: ${count} assignments</p>`;
                        });
                        html += '</div>';
                    }
                    
                    document.getElementById('parentPerformanceContent').innerHTML = html;
                } else {
                    document.getElementById('parentPerformanceContent').innerHTML = '<p>No performance data available.</p>';
                }
            } catch (error) {
                console.error('Error loading parent performance:', error);
                document.getElementById('parentPerformanceContent').innerHTML = '<p>Error loading performance data</p>';
            }
        }

        async function loadParentTeachers() {
            try {
                // Get student's department
                const studentEmail = currentUser.studentEmail;
                const response = await fetch(`/api/profile/${studentEmail}`);
                const result = await response.json();
                
                if (result.success) {
                    const student = result.user;
                    const teachersResponse = await fetch(`/api/teachers/${student.department}`);
                    const teachersResult = await teachersResponse.json();
                    
                    if (teachersResult.success) {
                        const teacherList = document.getElementById('teacherList');
                        teacherList.innerHTML = '';
                        
                        teachersResult.teachers.forEach(teacher => {
                            const teacherItem = document.createElement('div');
                            teacherItem.className = 'chat-teacher-item';
                            teacherItem.innerHTML = `
                                <i class="fas fa-chalkboard-teacher"></i>
                                <div>
                                    <h4>${teacher.name}</h4>
                                    <p>${teacher.subject} - ${teacher.email}</p>
                                </div>
                            `;
                            teacherItem.onclick = () => selectTeacher(teacher);
                            teacherList.appendChild(teacherItem);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading parent teachers:', error);
            }
        }

        function selectTeacher(teacher) {
            selectedTeacher = teacher;
            document.getElementById('teacherChatInput').classList.remove('hidden');
            document.getElementById('teacherList').classList.add('hidden');
            
            // Join chat room
            socket.emit('join-chat', {
                parentEmail: currentUser.email,
                teacherEmail: teacher.email
            });
            
            // Load chat history
            loadChatHistory(teacher.email);
        }

        async function loadChatHistory(teacherEmail) {
            try {
                const response = await fetch(`/api/chat-messages/${currentUser.email}/${teacherEmail}`);
                const result = await response.json();
                
                const chatMessages = document.getElementById('teacherChatMessages');
                chatMessages.innerHTML = '';
                
                if (result.success && result.messages.length > 0) {
                    result.messages.forEach(message => {
                        displayChatMessage(message);
                    });
                } else {
                    chatMessages.innerHTML = '<div class="chat-message teacher-message">Start a conversation with the teacher.</div>';
                }
                
                chatMessages.scrollTop = chatMessages.scrollHeight;
            } catch (error) {
                console.error('Error loading chat history:', error);
            }
        }

        function displayChatMessage(message) {
            const chatMessages = document.getElementById('teacherChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${message.sender === 'parent' ? 'parent-message' : 'teacher-message'}`;
            messageDiv.textContent = message.message;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendTeacherMessage() {
            const input = document.getElementById('teacherChatInputField');
            const message = input.value.trim();
            
            if (message && selectedTeacher) {
                socket.emit('send-chat-message', {
                    parentEmail: currentUser.email,
                    teacherEmail: selectedTeacher.email,
                    message: message,
                    sender: 'parent'
                });
                
                input.value = '';
            }
        }

        async function loadParentLeaderboard() {
            try {
                const response = await fetch('/api/leaderboard');
                const result = await response.json();
                
                let html = '';
                if (result.success && result.leaderboard.length > 0) {
                    result.leaderboard.forEach((student, index) => {
                        const rank = index + 1;
                        const isMyChild = student.email === currentUser.studentEmail;
                        html += `
                            <div class="leaderboard-item ${isMyChild ? 'highlighted' : ''}">
                                <div class="leaderboard-rank ${rank <= 3 ? `leaderboard-rank-${rank}` : ''}">
                                    ${rank}
                                </div>
                                <div class="leaderboard-student-info">
                                    <div class="leaderboard-student-name">${student.name} ${isMyChild ? '(Your Child)' : ''}</div>
                                    <div class="leaderboard-student-email">${student.email}</div>
                                </div>
                                <div class="leaderboard-student-credits">
                                    ${student.credits} Credits
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html = '<p>No leaderboard data available for this month.</p>';
                }
                document.getElementById('parentLeaderboardContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading parent leaderboard:', error);
                document.getElementById('parentLeaderboardContent').innerHTML = '<p>Error loading leaderboard</p>';
            }
        }

        async function loadParentNotifications() {
            try {
                const response = await fetch(`/api/notifications/${currentUser.email}`);
                const result = await response.json();
                
                let html = '';
                if (result.success && result.notifications.length > 0) {
                    result.notifications.forEach(notification => {
                        html += `
                            <div class="notification-item ${notification.read ? '' : 'unread'}" onclick="markParentNotificationAsRead('${notification.id}')">
                                <h4>${notification.title}</h4>
                                <p>${notification.message}</p>
                                <p><small>${new Date(notification.timestamp).toLocaleString()}</small></p>
                            </div>
                        `;
                    });
                } else {
                    html = '<p>No notifications.</p>';
                }
                document.getElementById('parentNotificationsContent').innerHTML = html;
            } catch (error) {
                console.error('Error loading parent notifications:', error);
                document.getElementById('parentNotificationsContent').innerHTML = '<p>Error loading notifications</p>';
            }
        }

        async function markParentNotificationAsRead(notificationId) {
            try {
                const response = await fetch('/api/notifications/mark-read', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ notificationId })
                });

                const result = await response.json();
                if (result.success) {
                    updateNotificationBadge();
                    loadParentNotifications();
                }
            } catch (error) {
                console.error('Error marking parent notification as read:', error);
            }
        }

        async function updateNotificationBadge() {
            try {
                const response = await fetch(`/api/notifications/${currentUser.email}`);
                const result = await response.json();
                
                if (result.success) {
                    const unreadCount = result.notifications.filter(n => !n.read).length;
                    let badge;
                    if (currentUserType === 'student') {
                        badge = document.getElementById('studentNotificationBadge');
                    } else if (currentUserType === 'teacher') {
                        badge = document.getElementById('teacherNotificationBadge');
                    } else if (currentUserType === 'parent') {
                        badge = document.getElementById('parentNotificationBadge');
                    }
                    
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('Error updating notification badge:', error);
            }
        }

        function downloadFile(url, filename) {
            // In a real application, this would download the file
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Chatbot functions
        function toggleChatbot() {
            const chatbot = document.getElementById('chatbot');
            chatbot.classList.toggle('active');
        }

        function toggleTeacherChat() {
            const teacherChat = document.getElementById('teacherChat');
            teacherChat.classList.toggle('active');
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (message) {
                // Add user message
                addChatMessage(message, 'user');
                input.value = '';

                try {
                    // Get AI response
                    const response = await fetch('/api/chatbot', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message })
                    });

                    const result = await response.json();
                    if (result.success) {
                        addChatMessage(result.response, 'bot');
                    }
                } catch (error) {
                    addChatMessage('Sorry, I am having trouble responding right now. Please try again later.', 'bot');
                }
            }
        }

        function addChatMessage(message, type) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.textContent = message;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Calendar function for live sessions
        function addToCalendar(title, description, dateTime, duration) {
            // This would integrate with calendar APIs in a real application
            alert(`Added "${title}" to your calendar. In a real application, this would integrate with Google Calendar, Outlook, etc.`);
        }

        // Initialize
        document.getElementById('chatbotInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        document.getElementById('teacherChatInputField').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendTeacherMessage();
            }
        });

        // Set today's date as default for attendance
        document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('assignmentDueDate').valueAsDate = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // One week from now
        document.getElementById('eventDate').valueAsDate = new Date(Date.now() + 14 * 24 * 60 * 60 * 1000); // Two weeks from now
        document.getElementById('liveSessionDateTime').valueAsDate = new Date(Date.now() + 24 * 60 * 60 * 1000); // Tomorrow

        // Handle leave document upload
        document.getElementById('leaveDocument').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                const fileList = document.getElementById('leaveDocumentPreview');
                fileList.innerHTML = `
                    <div class="file-item">
                        <div class="file-info">
                            <span class="file-icon"></span>
                            <span>${file.name}</span>
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="removeLeaveDocument()">Remove</button>
                    </div>
                `;
            }
        });

        function removeLeaveDocument() {
            document.getElementById('leaveDocument').value = '';
            document.getElementById('leaveDocumentPreview').innerHTML = '';
        }

        // Load initial data
        async function loadInitialData() {
            // These would be loaded from the server in a real application
            // For now, we'll initialize empty arrays
            enrollments = [];
            forumPosts = [];
            notifications = [];
            assignments = [];
            courses = [];
            timetables = [];
            events = [];
            liveSessions = [];
            questionPapers = [];
            leaderboard = [];
        }

        loadInitialData();
    </script>
</body>
</html>